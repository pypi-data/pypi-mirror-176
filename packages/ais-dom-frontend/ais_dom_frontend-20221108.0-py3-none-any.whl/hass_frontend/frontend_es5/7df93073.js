"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[55424],{92306:function(t,n,e){function r(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"==typeof t)return i(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return i(t,n)}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,a=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){c=!0,u=t},f:function(){try{a||null==e.return||e.return()}finally{if(c)throw u}}}}function i(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}e.d(n,{v:function(){return o}});var o=function(t,n){var e,i={},o=r(t);try{for(o.s();!(e=o.n()).done;){var u=e.value,a=n(u);a in i?i[a].push(u):i[a]=[u]}}catch(c){o.e(c)}finally{o.f()}return i}},11950:function(t,n,e){function r(t,n,e,r,i,o,u){try{var a=t[o](u),c=a.value}catch(s){return void e(s)}a.done?n(c):Promise.resolve(c).then(r,i)}e.d(n,{l:function(){return i}});var i=function(){var t,n=(t=regeneratorRuntime.mark((function t(n,e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var r=e(n,(function(n){r(),t(n)}))})));case 1:case"end":return t.stop()}}),t)})),function(){var n=this,e=arguments;return new Promise((function(i,o){var u=t.apply(n,e);function a(t){r(u,i,o,a,c,"next",t)}function c(t){r(u,i,o,a,c,"throw",t)}a(void 0)}))});return function(t,e){return n.apply(this,arguments)}}()},81582:function(t,n,e){e.d(n,{LZ:function(){return r},Q4:function(){return i},DJ:function(){return o},pB:function(){return u},SO:function(){return a},iJ:function(){return c},Nn:function(){return s},Ny:function(){return f},T0:function(){return l}});var r=["migration_error","setup_error","setup_retry"],i=["not_loaded","loaded","setup_error","setup_retry"],o=function(t,n,e){var r={type:"config_entries/subscribe"};return e&&e.type&&(r.type_filter=e.type),t.connection.subscribeMessage((function(t){return n(t)}),r)},u=function(t,n){var e={};return n&&(n.type&&(e.type_filter=n.type),n.domain&&(e.domain=n.domain)),t.callWS(Object.assign({type:"config_entries/get"},e))},a=function(t,n,e){return t.callWS(Object.assign({type:"config_entries/update",entry_id:n},e))},c=function(t,n){return t.callApi("DELETE","config/config_entries/entry/".concat(n))},s=function(t,n){return t.callApi("POST","config/config_entries/entry/".concat(n,"/reload"))},f=function(t,n){return t.callWS({type:"config_entries/disable",entry_id:n,disabled_by:"user"})},l=function(t,n){return t.callWS({type:"config_entries/disable",entry_id:n,disabled_by:null})}},55424:function(t,n,e){e.d(n,{Bm:function(){return A},o1:function(){return O},iK:function(){return I},rl:function(){return W},P:function(){return Z},KU:function(){return P},Cj:function(){return C},xZ:function(){return E},gy:function(){return D},ZC:function(){return R},_Z:function(){return L},Jj:function(){return H},yH:function(){return B},UB:function(){return N},jB:function(){return J},G9:function(){return q},vE:function(){return G},b:function(){return Q}});var r=e(4535),i=e(59699),o=e(32182),u=e(79021),a=e(39244),c=e(27088),s=e(83008),f=e(70390),l=e(47538),y=e(97330),d=e(92306),_=e(11950),p=e(81582),m=e(74186),g=e(38014);function v(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||w(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var r,i,o=[],u=!0,a=!1;try{for(e=e.call(t);!(u=(r=e.next()).done)&&(o.push(r.value),!n||o.length!==n);u=!0);}catch(c){a=!0,i=c}finally{try{u||null==e.return||e.return()}finally{if(a)throw i}}return o}(t,n)||w(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=w(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,u=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return u=t.done,t},e:function(t){a=!0,o=t},f:function(){try{u||null==e.return||e.return()}finally{if(a)throw o}}}}function w(t,n){if(t){if("string"==typeof t)return S(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?S(t,n):void 0}}function S(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function x(t,n,e,r,i,o,u){try{var a=t[o](u),c=a.value}catch(s){return void e(s)}a.done?n(c):Promise.resolve(c).then(r,i)}function k(t){return function(){var n=this,e=arguments;return new Promise((function(r,i){var o=t.apply(n,e);function u(t){x(o,r,i,u,a,"next",t)}function a(t){x(o,r,i,u,a,"throw",t)}u(void 0)}))}}var j,T=[],A=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},O=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},I=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},W=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},Z=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},P=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},C=function(){return{type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},E=function(t){return t.callWS({type:"energy/info"})},D=function(t){return t.callWS({type:"energy/validate"})},R=function(t){return t.callWS({type:"energy/get_prefs"})},L=32143==e.j?(j=k(regeneratorRuntime.mark((function t(n,e){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.callWS(Object.assign({type:"energy/save_prefs"},e)),U(n),t.abrupt("return",r);case 3:case"end":return t.stop()}}),t)}))),function(t,n){return j.apply(this,arguments)}):null,M=function(){var t=k(regeneratorRuntime.mark((function t(n,e,r,i,o){var u,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=a.length>5&&void 0!==a[5]?a[5]:"hour",t.abrupt("return",n.callWS({type:"energy/fossil_energy_consumption",start_time:e.toISOString(),end_time:null==o?void 0:o.toISOString(),energy_statistic_ids:r,co2_statistic_id:i,period:u}));case 2:case"end":return t.stop()}}),t)})));return function(n,e,r,i,o){return t.apply(this,arguments)}}(),H=function(t){return(0,d.v)(t.energy_sources,(function(t){return t.type}))},B=function(t,n,e){var r,i=[],o=b(t.energy_sources);try{for(o.s();!(r=o.n()).done;){var u=r.value;if(!e||e.includes(u.type))if("solar"!==u.type)if("gas"!==u.type&&"water"!==u.type)if("battery"!==u.type){var a,c=b(u.flow_from);try{for(c.s();!(a=c.n()).done;){var s=a.value;i.push(s.stat_energy_from),s.stat_cost&&i.push(s.stat_cost);var f=n.cost_sensors[s.stat_energy_from];f&&i.push(f)}}catch(m){c.e(m)}finally{c.f()}var l,y=b(u.flow_to);try{for(y.s();!(l=y.n()).done;){var d=l.value;i.push(d.stat_energy_to),d.stat_compensation&&i.push(d.stat_compensation);var _=n.cost_sensors[d.stat_energy_to];_&&i.push(_)}}catch(m){y.e(m)}finally{y.f()}}else i.push(u.stat_energy_from),i.push(u.stat_energy_to);else{i.push(u.stat_energy_from),u.stat_cost&&i.push(u.stat_cost);var p=n.cost_sensors[u.stat_energy_from];p&&i.push(p)}else i.push(u.stat_energy_from)}}catch(m){o.e(m)}finally{o.f()}return i},K=function(){var t=k(regeneratorRuntime.mark((function t(n,e,c,s,f){var l,y,d,w,S,x,k,j,T,A,O,I,W,Z,P,C,D,R,L,H,K,U,N,J,$,q,G,Q,Y,z,F,V,X,tt,nt,et,rt;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([(0,p.pB)(n,{domain:"co2signal"}),(0,_.l)(n.connection,m.LM),E(n)]);case 2:if(l=t.sent,y=h(l,3),d=y[0],w=y[1],S=y[2],!(x=d.length?d[0]:void 0)){t.next=31;break}j=b(w),t.prev=10,j.s();case 12:if((T=j.n()).done){t.next=23;break}if((A=T.value).config_entry_id===x.entry_id){t.next=16;break}return t.abrupt("continue",21);case 16:if((O=n.states[A.entity_id])&&"%"===O.attributes.unit_of_measurement){t.next=19;break}return t.abrupt("continue",21);case 19:return k=O.entity_id,t.abrupt("break",23);case 21:t.next=12;break;case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(10),j.e(t.t0);case 28:return t.prev=28,j.f(),t.finish(28);case 31:I=[],W=b(e.energy_sources);try{for(W.s();!(Z=W.n()).done;)if("grid"===(P=Z.value).type){C=b(P.flow_from);try{for(C.s();!(D=C.n()).done;)R=D.value,I.push(R.stat_energy_from)}catch(it){C.e(it)}finally{C.f()}}}catch(it){W.e(it)}finally{W.f()}return L=B(e,S,["grid","solar","battery","gas"]),H=B(e,S,["water"]),K=[].concat(v(L),v(H)),U=(0,r.Z)(s||new Date,c),N=U>35?"month":U>2?"day":"hour",J=(0,i.Z)(c,-1),$=n.config.unit_system.length||"",q={energy:"kWh",volume:"km"===$?"m³":"ft³"},G={volume:"km"===$?"L":"gal"},t.t1=Object,t.t2={},t.next=47,(0,g.dL)(n,J,s,L,N,q);case 47:return t.t3=t.sent,t.next=50,(0,g.dL)(n,J,s,H,N,G);case 50:if(t.t4=t.sent,Q=t.t1.assign.call(t.t1,t.t2,t.t3,t.t4),!f){t.next=65;break}return z=U>27&&U<32?(0,o.Z)(c,-1):(0,u.Z)(c,-1*(U+1)),V=(0,i.Z)(z,-1),F=(0,a.Z)(c,-1),t.t5=Object,t.t6={},t.next=60,(0,g.dL)(n,V,F,L,N,q);case 60:return t.t7=t.sent,t.next=63,(0,g.dL)(n,J,s,H,N,G);case 63:t.t8=t.sent,Y=t.t5.assign.call(t.t5,t.t6,t.t7,t.t8);case 65:if(void 0===k){t.next=73;break}return t.next=68,M(n,c,I,k,s,U>35?"month":U>2?"day":"hour");case 68:if(X=t.sent,!f){t.next=73;break}return t.next=72,M(n,z,I,k,F,U>35?"month":U>2?"day":"hour");case 72:tt=t.sent;case 73:return Object.values(Q).forEach((function(t){t.length&&new Date(t[0].start)>J&&t.unshift(Object.assign({},t[0],{start:J.toISOString(),end:J.toISOString(),sum:0,state:0}))})),t.next=76,(0,g.Py)(n,K);case 76:return nt=t.sent,et={},nt.forEach((function(t){et[t.statistic_id]=t})),rt={start:c,end:s,startCompare:z,endCompare:F,info:S,prefs:e,stats:Q,statsMetadata:et,statsCompare:Y,co2SignalConfigEntry:x,co2SignalEntity:k,fossilEnergyConsumption:X,fossilEnergyConsumptionCompare:tt},t.abrupt("return",rt);case 81:case"end":return t.stop()}}),t,null,[[10,25,28,31]])})));return function(n,e,r,i,o){return t.apply(this,arguments)}}(),U=function(t){T.forEach((function(n){var e=N(t,{key:n});e.clearPrefs(),e._active&&e.refresh()}))},N=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e="_energy";if(n.key){if(!n.key.startsWith("energy_"))throw new Error("Key need to start with energy_");e="_".concat(n.key)}if(t.connection[e])return t.connection[e];T.push(n.key);var r=(0,y._)(t.connection,e,k(regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.prefs){n.next=4;break}return n.next=3,R(t);case 3:r.prefs=n.sent;case 4:return r._refreshTimeout&&clearTimeout(r._refreshTimeout),r._active&&(!r.end||r.end>new Date)&&((e=new Date).getMinutes()>=20&&e.setHours(e.getHours()+1),e.setMinutes(20,0,0),r._refreshTimeout=window.setTimeout((function(){return r.refresh()}),e.getTime()-Date.now())),n.abrupt("return",K(t,r.prefs,r.start,r.end,r.compare));case 7:case"end":return n.stop()}}),n)})))),o=r.subscribe;r.subscribe=function(t){var n=o(t);return r._active++,function(){r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),n()}},r._active=0,r.prefs=n.prefs;var u=new Date;r.start=u.getHours()>0?(0,c.Z)():(0,s.Z)(),r.end=u.getHours()>0?(0,f.Z)():(0,l.Z)();var a=function t(){r._updatePeriodTimeout=window.setTimeout((function(){r.start=(0,c.Z)(),r.end=(0,f.Z)(),t()}),(0,i.Z)((0,f.Z)(),1).getTime()-Date.now())};return a(),r.clearPrefs=function(){r.prefs=void 0},r.setPeriod=function(t,n){var e;r.start=t,r.end=n,r.start.getTime()!==(0,c.Z)().getTime()||(null===(e=r.end)||void 0===e?void 0:e.getTime())!==(0,f.Z)().getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):a()},r.setCompare=function(t){r.compare=t},r},J=function(t){return t.callWS({type:"energy/solar_forecast"})},$=["volume","energy"],q=function(t){var n,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=b(t.energy_sources);try{for(i.s();!(n=i.n()).done;){var o=n.value;if("gas"===o.type&&(!r||r!==o.stat_energy_from)){var u=e[o.stat_energy_from];if($.includes(null==u?void 0:u.unit_class))return u.unit_class}}}catch(a){i.e(a)}finally{i.f()}},G=function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=q(n,e);if(void 0!==r)return"energy"===r?"kWh":"km"===t.config.unit_system.length?"m³":"ft³"},Q=function(t){return"km"===t.config.unit_system.length?"L":"gal"}},38014:function(t,n,e){e.d(n,{uR:function(){return u},Py:function(){return a},dL:function(){return c},_Y:function(){return s},h_:function(){return f},Cj:function(){return l},hN:function(){return y},Kj:function(){return d},q6:function(){return _},Nw:function(){return p},Z0:function(){return v},j2:function(){return h},Kd:function(){return b},dO:function(){return w},Hs:function(){return S}});var r=e(91741);function i(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"==typeof t)return o(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return o(t,n)}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,a=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){c=!0,u=t},f:function(){try{a||null==e.return||e.return()}finally{if(c)throw u}}}}function o(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}var u=function(t,n){return t.callWS({type:"recorder/list_statistic_ids",statistic_type:n})},a=function(t,n){return t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:n})},c=function(t,n,e,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"hour",o=arguments.length>5?arguments[5]:void 0;return t.callWS({type:"recorder/statistics_during_period",start_time:n.toISOString(),end_time:null==e?void 0:e.toISOString(),statistic_ids:r,period:i,units:o})},s=function(t,n,e,r){return t.callWS({type:"recorder/statistic_during_period",statistic_id:n,units:r,fixed_period:e.fixed_period?{start_time:e.fixed_period.start instanceof Date?e.fixed_period.start.toISOString():e.fixed_period.start,end_time:e.fixed_period.end instanceof Date?e.fixed_period.end.toISOString():e.fixed_period.end}:void 0,calendar:e.calendar,rolling_window:e.rolling_window})},f=function(t){return t.callWS({type:"recorder/validate_statistics"})},l=function(t,n,e){return t.callWS({type:"recorder/update_statistics_metadata",statistic_id:n,unit_of_measurement:e})},y=function(t,n){return t.callWS({type:"recorder/clear_statistics",statistic_ids:n})},d=function(t){if(!t||t.length<2)return null;var n=t[t.length-1].sum;if(null===n)return null;var e=t[0].sum;return null===e?n:n-e},_=function(t,n){var e,r=null,o=i(n);try{for(o.s();!(e=o.n()).done;){var u=e.value;if(u in t){var a=d(t[u]);null!==a&&(null===r?r=a:r+=a)}}}catch(c){o.e(c)}finally{o.f()}return r},p=function(t,n){return t.some((function(t){return null!==t[n]}))},m=["mean","min","max"],g=["sum"],v=function(t,n){return!(!m.includes(n)||!t.has_mean)||!(!g.includes(n)||!t.has_sum)},h=function(t,n,e,r,i){return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:n,start_time:e,adjustment:r,adjustment_unit_of_measurement:i})},b=function(t,n,e){var i=t.states[n];return i?(0,r.C)(i):(null==e?void 0:e.name)||n},w=function(t,n,e){var r,i;n&&(r=null===(i=t.states[n])||void 0===i?void 0:i.attributes.unit_of_measurement);return void 0===r?null==e?void 0:e.statistics_unit_of_measurement:r},S=function(t){return t.includes(":")}}}]);