"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8749],{42959:(e,t,a)=>{var o=a(63025),i=a(53806),n=a.n(i),r=a(12394);const c=o.ZP.bind(null,{endpoint:"rb.check_room_available",rules:[{args:["room_id"],converters:{room_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1},{data:"room_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"availability",isDynamic:!1},{data:"/",isDynamic:!1},{data:"simple",isDynamic:!1}]}]},"/"),s=o.ZP.bind(null,{endpoint:"rb.roombooking",rules:[{args:["path"],converters:{path:"PathConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1},{data:"path",isDynamic:!0}]},{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"rooms",isDynamic:!1},{data:"/",isDynamic:!1}]}]},"/");window.setupEventCreationDialog=function(e){e=$.extend({categoryField:null,listingValue:null,protectionModeFields:null,initialCategory:null,checkAvailability:!1,rbExcludedCategories:null,serverDefaultTimezone:null},e);const t=$($.parseHTML($("#event-creation-protection-messages").html())),a=$("<div>",{class:"form-group",css:{marginTop:"5px"}}),o=$($.parseHTML($("#event-listing-message").html())),i=$("#event-creation-create_booking"),l=$("#room-available"),d=$("#room-available-prebook"),g=$("#room-conflict-booking"),m=$("#room-conflict-prebooking"),v=$("#room-conflict-prebooking-prebook"),p=$("#room-user-booking"),u=$("#room-user-prebooking"),h=$("#room-unbookable"),f=$("#room-cannot-book"),y=$("#create-booking"),D=$("#create-prebooking"),b=$("#create-booking-over-prebooking"),k=$("#create-prebooking-over-prebooking"),Y=$("#event-creation-listing-checkbox");let _,M,H,S,C,T,F,O=null,x=!1;function E(){if(!O)return void a.html("");let o=e.protectionModeFields.filter(":checked").val();"inheriting"===o&&(o=O.is_protected?"inheriting-protected":"inheriting-public");const i=t.filter(`.${o}-protection-message`);i.find(".js-category-title").text(O&&O.title),a.html(i)}function J(e){H=n()(`${e.date} ${e.time}`,"YYYY-MM-DD HH:mm"),S=n()(H).add(e.duration,"minutes")}function N(t){return e.rbExcludedCategories.some((e=>parseInt(e.id,10)===t))}function w(e){const t={path:"calendar",date:H.format("YYYY-MM-DD"),text:T.room_name},a=s(t);e.find("a").prop("href",a)}function A(e){M&&(e&&($("#availability-messages").find("input[id^='create']").prop("checked",!1),i.val("false")),M.hide())}function L(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(A(t),!("room_id"in T)||!H.isValid()||!S.isValid()||!H.isSame(S,"day")||H.isSameOrAfter(S)||N(C.id)||F!==e.serverDefaultTimezone||x)return void i.val("false");const a={room_id:T.room_id,start_dt:H.format(n().HTML5_FMT.DATETIME_LOCAL),end_dt:S.format(n().HTML5_FMT.DATETIME_LOCAL)};$.ajax({url:c(a),method:"GET",dataType:"json",contentType:"application/json",error:handleAjaxError,success(e){(e=(0,r.k)(e)).userBooking?(i.val("false"),M=p,w(M)):e.userPrebooking?(i.val("false"),M=u,w(M)):e.conflictBooking?(i.val("false"),M=g,w(M)):e.unbookable?(i.val("false"),M=h,w(M)):e.conflictPrebooking?e.canBook?(i.val(String(b[0].checked)),M=m,w(M)):e.canPrebook?(i.val(String(k[0].checked)),M=v,w(M)):(i.val("false"),M=f):e.canBook?(i.val(String(y[0].checked)),M=l):e.canPrebook?(i.val(String(D[0].checked)),M=d):(i.val("false"),M=f),M.show()}})}a.appendTo(e.protectionModeFields.closest(".form-field")),o.appendTo(Y.closest(".form-field")),e.categoryField.on("indico:categorySelected",((t,a)=>{O||e.protectionModeFields.filter("[value=inheriting]").prop("checked",!0),a?e.protectionModeFields.prop("disabled",!1):(e.protectionModeFields.prop("disabled",!0),e.protectionModeFields.filter("[value=inheriting]").prop("checked",!0)),O=a,E()})),Y.on("change",(t=>{JSON.parse(t.target.value)?($("#form-group-event-creation-category").show(),$("#form-group-event-creation-protection_mode").show(),e.categoryField.val(JSON.stringify(e.initialCategory)),e.categoryField.trigger("indico:categorySelected",[e.initialCategory]),$("#category-title-event-creation-category").text(e.initialCategory?e.initialCategory.title:"")):($("#form-group-event-creation-category").hide(),$("#form-group-event-creation-protection_mode").hide(),e.categoryField.trigger("indico:categorySelected",[])),o.toggleClass("hidden",JSON.parse(Y.val())),$("#category-warning-event-creation-category").toggleClass("hidden",O&&O.has_events||!O)})),e.protectionModeFields.on("change",(function(){E()})),e.initialCategory?e.categoryField.trigger("indico:categorySelected",[e.initialCategory]):e.protectionModeFields.prop("disabled",!0),e.checkAvailability&&(function(){const e=$("#event-creation-start_dt-datestorage").val(),t=$("#event-creation-start_dt-timestorage").val(),a=$("#event-creation-end_dt-datestorage").val(),o=$("#event-creation-end_dt-timestorage").val(),i=$("#event-creation-occurrences").val(),r=i?JSON.parse(i):null;T=JSON.parse($("#event-creation-location_data").val()),F=$("#event-creation-timezone").val(),C=JSON.parse($("#event-creation-category").val()),r&&1===r.length?J(r[0]):(H=n()(`${e} ${t}`,"DD/MM/YYYY HH:mm"),S=n()(`${a} ${o}`,"DD/MM/YYYY HH:mm"))}(),$("#event-creation-location_data").on("change",(function(){T=JSON.parse($(this).val()),_!==T.room_id&&(_=T.room_id,L(!0))})),$("#event-creation-start_dt-datestorage").on("change",(function(){const e=$(this).val(),t=$("#event-creation-start_dt-timestorage").val(),a=$("#event-creation-end_dt-datestorage").val(),o=$("#event-creation-end_dt-timestorage").val();H=n()(`${e} ${t}`,"DD/MM/YYYY HH:mm"),S=n()(`${a} ${o}`,"DD/MM/YYYY HH:mm"),S.isBefore(H)&&(S=n()(`${e} ${o}`,"DD/MM/YYYY HH:mm")),L()})),$("#event-creation-start_dt-timestorage").on("change",(function(){const e=$("#event-creation-start_dt-datestorage").val(),t=$("#event-creation-start_dt-timestorage").val();H=n()(`${e} ${t}`,"DD/MM/YYYY HH:mm"),L()})),$("#event-creation-end_dt-datestorage").on("change",(function(){const e=$(this).val(),t=$("#event-creation-end_dt-timestorage").val();S=n()(`${e} ${t}`,"DD/MM/YYYY HH:mm"),L()})),$("#event-creation-end_dt-timestorage").on("change",(function(){const e=$("#event-creation-end_dt-datestorage").val(),t=$(this).val();S=n()(`${e} ${t}`,"DD/MM/YYYY HH:mm"),L()})),$("#event-creation-occurrences").on("change",(function(){const e=JSON.parse($(this).val());1===e.length?(J(e[0]),x=!1):x=!0,L()})),$("#event-creation-timezone").on("change",(function(){F=$(this).val(),L()})),$("#event-creation-category").on("change",(function(){C=JSON.parse($(this).val()),L()})),y.add(D).add(b).add(k).on("change",(function(){i.val(String(this.checked))})))}}},e=>{e.O(0,[8592],(()=>{return t=42959,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_events.creation.e42b61e1.bundle.js.map