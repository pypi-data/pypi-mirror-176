(self.webpackChunk=self.webpackChunk||[]).push([[3827],{98791:()=>{window.setupBadgePrinting=function(e){const t=$("#template"),n=$("#page_layout"),a=$("#dashed_border"),s=$("#page_size"),i=$("#page_orientation"),l=$(".margin-editor"),r=$(".info");function o(e,t,n){({A0:"A2",A1:"A3",A2:"A4",A3:"A5",A4:"A6",A5:"A7",A6:"A8"})[t]===e.format&&n===e.orientation?$("#page_layout option[value='foldable']").prop("disabled",!1):($("#page_layout option[value='foldable']").prop("disabled",!0),"foldable"===$("#page_layout :selected").val()&&$("#page_layout :selected").next().prop("selected",!0))}t.on("change",(function(){const t=$(this),a=e[parseInt(t.val(),10)];n.closest(".form-group").toggle(!!a.backside_tpl_id),n.val("front_only"),o(a,s.val(),i.val())})).change(),n.on("change",(function(){l.add(r).toggle("foldable"!==$(this).val()),a.closest(".form-group").toggle("foldable"!==$(this).val())})).change(),s.add(i).on("change",(function(){o(e[parseInt(t.val(),10)],s.val(),i.val()),n.change()})).change()}},28862:(e,t,n)=>{"use strict";var a=n(90567),s=n.n(a),i=n(32735),l=n(12788),r=(n(17388),n(70967),n(98791),n(28995)),o=n(17816),c=n(72963),d=n(63025),u=n(89793),m=n.n(u),g=n(53806),v=n.n(g),_=n(60216),h=n.n(_),p=n(73537),f=n(41612),y=n(67986),b=n(74763),E=n(68301),N=n(75723),I=n(59965),w=n(37314),j=n(17636),k=n(33344),q=n(54733),S=n(95524),C=n(19306),D=n(59090),R=n(5163);const M=d.ZP.bind(null,{endpoint:"categories.event_search",rules:[{args:["category_id"],converters:{category_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category",isDynamic:!1},{data:"/",isDynamic:!1},{data:"category_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"events",isDynamic:!1},{data:"/",isDynamic:!1},{data:"search-for-series",isDynamic:!1}]}]},"/"),x=d.ZP.bind(null,{endpoint:"event_series.event_series",rules:[{args:["series_id"],converters:{series_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event-series",isDynamic:!1},{data:"/",isDynamic:!1},{data:"series_id",isDynamic:!0}]},{args:[],converters:{},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event-series",isDynamic:!1},{data:"/",isDynamic:!1}]}]},"/"),A=d.ZP.bind(null,{endpoint:"events.single_event_api",rules:[{args:["event_id"],converters:{event_id:"IntegerConverter"},defaults:{},trace:[{data:"|",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event",isDynamic:!1},{data:"/",isDynamic:!1},{data:"event_id",isDynamic:!0},{data:"/",isDynamic:!1},{data:"api",isDynamic:!1},{data:"/",isDynamic:!1},{data:"info-for-series",isDynamic:!1}]}]},"/"),T=(0,R.c)(250),F=(0,R.c)(250);function Z(e){let{eventId:t,categoryId:n,seriesId:a,timezone:s}=e;const l=null!==a,[r,o]=(0,i.useState)(!1),{loading:c,reFetch:d,data:u}=(0,S.K3)(l?x({series_id:a}):A({event_id:t}),{manual:!0}),m=async()=>{await d(),o(!0)},g=u?l?u:{id:null,events:[u],show_sequence_in_title:!1,show_links:!1,event_title_pattern:""}:null;return i.createElement(i.Fragment,null,l?i.createElement(j.IButton,{borderless:!0,icon:"stack",title:C.vN.string("Manage event series"),onClick:m},i.createElement(C.vN,null,"Manage series")):i.createElement(j.IButton,{borderless:!0,icon:"stack",title:C.vN.string("Create event series"),onClick:m},i.createElement(C.vN,null,"Create series")),i.createElement(p.Z,{active:c,page:!0,inverted:!0},i.createElement(f.Z,null)),r&&i.createElement(z,{currentEventId:t,categoryId:n,timezone:s,series:g,onClose:()=>{o(!1)}}))}function z(e){let{currentEventId:t,categoryId:n,series:a,timezone:s,onClose:l}=e;const[r,o]=(0,i.useState)(!1),c=null!==a.id,d=e=>v()(e).tz(s);return i.createElement(i.Fragment,null,i.createElement(q.Yp,{id:"event-series",header:c?C.vN.string("Manage series"):C.vN.string("Create series"),size:"standard",alignTop:!0,onSubmit:async(e,t)=>{const n=c?(0,q.k4)(e,t):(0,q.hS)(e,t);n.events&&(n.event_ids=n.events.map((e=>e.id)),delete n.events);try{c?await D.l2.patch(x({series_id:a.id}),n):await D.l2.post(x(),n)}catch(e){return(0,k.qf)(e,{event_ids:"events"})}location.reload(),await new Promise((()=>{}))},onClose:l,initialValues:a,disabledUntilChange:c,extraActions:e=>c&&i.createElement(y.Z,{style:{marginRight:"auto"},onClick:()=>o(!0),disabled:e.submitting,negative:!0},i.createElement(C.vN,null,"Delete series")),submitLabel:c?C.vN.string("Update series"):C.vN.string("Create series")},(()=>i.createElement(i.Fragment,null,i.createElement(k.HS,{name:"events",isEqual:(e,t)=>m()((e||[]).map((e=>e.id)),(t||[]).map((e=>e.id))),validate:e=>{if(!e.length)return C.vN.string("A series needs to contain at least one event.")},component:U,localMoment:d,categoryId:n,currentEventId:t,existingSeriesId:a.id,divider:i.createElement(b.Z,{horizontal:!0},c?i.createElement(C.vN,null,"Events in series"):i.createElement(C.vN,null,"Events to add"))}),i.createElement(b.Z,{horizontal:!0},i.createElement(C.vN,null,"Series options")),i.createElement(k.fw,{name:"show_sequence_in_title",label:C.vN.string("Show the sequence number in the event titles (lectures only)")}),i.createElement(k.fw,{name:"show_links",label:C.vN.string("Show links to the other events of the series on the main event page")}),i.createElement(k._t,{name:"event_title_pattern",label:C.vN.string("Event title pattern"),description:i.createElement(C.vN,null,"Title pattern for cloned events. Must contain the"," ",i.createElement(C.dO,{name:"placeholder",wrapper:i.createElement("code",null),value:"{n}"})," placeholder which will indicate the new event's position in the series."),validate:e=>{if(e&&!e.includes("{n}"))return C.vN.string("Title pattern must contain the {placeholder} placeholder",{placeholder:"{n}"})}})))),i.createElement(j.RequestConfirmDelete,{open:r,onClose:()=>o(!1),requestFunc:async()=>{try{await D.l2.delete(x({series_id:a.id}))}catch(e){return(0,D.zZ)(e),!0}location.reload()},persistent:!0},i.createElement(C.vN,null,"Do you really want to delete this series? The associated events will not be deleted.")))}function U(e){let{value:t,onChange:n,onFocus:a,onBlur:s,divider:l,localMoment:r,categoryId:o,currentEventId:c,existingSeriesId:d}=e;const[u,m]=(0,i.useState)(void 0),[g,_]=(0,i.useState)([]),[h,p]=(0,i.useState)(!1),[f,y]=(0,i.useState)(null),b=null!==d,$=async e=>{let t;try{t=await F((()=>D.l2.get(A({event_id:+e}))))}catch(e){return void(0,D.zZ)(e)}if(null===t.data)y(C.vN.string("No event found with this ID."));else if(t.data.can_access){if(t.data.category_chain)return _([t.data]),y(null),void p(!1);y(C.vN.string("This event is unlisted."))}else y(C.vN.string("You don't have rights to access this event."));p(!1),_([])},k=new Set(t.map((e=>e.id))),q=g.map((e=>({key:e.id,value:e.id,text:e.title,disabled:!e.can_manage||!e.category_chain||e.series_id!==d&&null!==e.series_id||k.has(e.id),content:i.createElement("div",{className:"events-management-client-js-___SeriesManagement-module__list-flex___DE65m"},i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__date-span___8yRl2"},r(e.start_dt).format("ll")),i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__event-title___961dm"},e.title,i.createElement("br",null),i.createElement(j.TooltipIfTruncated,null,i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__category-chain___SNXOv"},e.category_chain?e.category_chain.join(" Â» "):i.createElement(C.vN,null,"Unlisted"))),!e.can_manage&&i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__warning-reason___ag6NQ"},i.createElement("br",null),i.createElement(C.vN,null,"You do not have editing rights for this event.")),!e.category_chain&&i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__warning-reason___ag6NQ"},i.createElement("br",null),i.createElement(C.vN,null,"This event is unlisted.")),e.series_id!==d&&null!==e.series_id&&i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__warning-reason___ag6NQ"},i.createElement("br",null),i.createElement(C.vN,null,"This event is already part of a different series.")),k.has(e.id)&&i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__positive-note___TNVKv"},i.createElement("br",null),i.createElement(C.vN,null,"This event is already part of this series."))))})));return i.createElement(i.Fragment,null,i.createElement(E.Z,{fluid:!0,selection:!0,search:e=>e,icon:"search",selectOnBlur:!1,selectOnNavigation:!1,placeholder:C.vN.string("Search for an event title or paste an event URL or event ID (#123)"),options:q,value:null,loading:h,onSearchChange:async(e,t)=>{let{searchQuery:n}=t;if(m(n),n=n.trim(),y(null),!n)return p(!1),void _([]);const a=new RegExp(`^${location.origin.replace("/","\\/")}\\/event\\/([0-9]+)`),s=n.match(a);s?(p(!0),$(s[1])):/^#([0-9])+$/.test(n)?(p(!0),$(n.substr(1))):"#"!==n&&(p(!0),(async e=>{let t;try{t=await T((()=>D.l2.get(M({category_id:o,q:e}))))}catch(e){return void(0,D.zZ)(e)}_(t.data),y(null),p(!1)})(n))},searchQuery:u,onChange:(e,a)=>{let{value:s}=a;const i=g.find((e=>e.id===s)),l=[...t,i].sort(((e,t)=>v()(e.start_dt)-v()(t.start_dt)));n(l)},onFocus:a,onBlur:s,noResultsMessage:h?C.vN.string("Searching..."):null!==f?f:u?C.vN.string("No results found."):C.vN.string("Enter search term")}),l,i.createElement(N.Z,{divided:!0,relaxed:!0,className:"events-management-client-js-___SeriesManagement-module__evt-list___PkKqH"},t.map((e=>i.createElement(N.Z.Item,{key:e.id,className:"events-management-client-js-___SeriesManagement-module__evt-item___5iu8a"},i.createElement(N.Z.Content,null,i.createElement("div",{className:"events-management-client-js-___SeriesManagement-module__list-flex___DE65m"},i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__date-span___8yRl2"},r(e.start_dt).format("ll"),i.createElement("br",null),c===e.id&&i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__positive-note___TNVKv"},"(",i.createElement(C.vN,null,"this event"),")")),i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__event-title___961dm"},e.title,i.createElement("br",null),i.createElement(j.TooltipIfTruncated,null,i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__detail___mXZyy"},e.category_chain?e.category_chain.join(" Â» "):i.createElement("span",{className:"events-management-client-js-___SeriesManagement-module__warning-reason___ag6NQ"},i.createElement(C.vN,null,"Unlisted"))))),(c!==e.id||b)&&i.createElement(I.Z,{trigger:i.createElement(w.Z,{className:"events-management-client-js-___SeriesManagement-module__delete-button___BZmEH",name:"close",onClick:()=>{a(),s(),n(t.filter((t=>t.id!==e.id)))},link:!0}),content:C.vN.string("Remove from event series"),position:"bottom center"}))))))))}Z.propTypes={eventId:h().number.isRequired,categoryId:h().number.isRequired,timezone:h().string.isRequired,seriesId:h().number},Z.defaultProps={seriesId:null},z.propTypes={currentEventId:h().number.isRequired,categoryId:h().number.isRequired,series:h().shape({id:h().number,events:h().arrayOf(h().object).isRequired,show_sequence_in_title:h().bool.isRequired,show_links:h().bool.isRequired,event_title_pattern:h().string.isRequired}).isRequired,timezone:h().string.isRequired,onClose:h().func.isRequired},U.propTypes={value:h().arrayOf(h().object).isRequired,onChange:h().func.isRequired,divider:h().node.isRequired,localMoment:h().func.isRequired,categoryId:h().number.isRequired,currentEventId:h().number.isRequired,existingSeriesId:h().number,onFocus:h().func.isRequired,onBlur:h().func.isRequired},U.defaultProps={existingSeriesId:null},function(e){function t(){$("#person-filters ul > li").removeClass("enabled");const e=$(".js-event-person-list tr[data-person-roles]"),t=$(".js-event-person-list [data-filter]:checked").map((function(){const e=$(this);return e.closest("li").addClass("enabled"),e.data("filter")})).get(),n=e.filter(((e,n)=>!t.length||t.find((e=>$(n).data("person-roles")[e]))));e.addClass("hidden"),n.removeClass("hidden"),$(".js-event-person-list").trigger("indico:syncEnableIfChecked")}function n(){$(".js-reset-role-filter").toggleClass("disabled",0===$("#person-filters [data-filter]:checked").length)}function a(){$(".js-show-regforms").qtip({content:{text(){return $(this).data("title")}},hide:{delay:100,fixed:!0}})}e.setupEventManagementActionMenu=function(){const e=document.querySelector("#event-action-move-container");e&&l.render(i.createElement(c.BN,{eventId:+e.dataset.eventId,currentCategoryId:+e.dataset.categoryId,hasPendingMoveRequest:void 0!==e.dataset.pendingRequest}),e);const t=document.querySelector("#event-action-manage-series-container");if(t){const e=void 0!==t.dataset.seriesId?+t.dataset.seriesId:null;l.render(i.createElement(Z,{eventId:+t.dataset.eventId,categoryId:+t.dataset.categoryId,timezone:t.dataset.timezone,seriesId:e}),t)}const n=document.querySelector("#event-action-publish-container");n&&l.render(i.createElement(c.CT,{eventId:+n.dataset.eventId,hasPendingPublishRequest:void 0!==n.dataset.pendingRequest}),n),$("#event-action-menu-clones-target").qbubble({content:{text:$("#event-action-menu-clones")}}),$("#event-action-menu-actions-target").qbubble({content:{text:$("#event-action-menu-actions")},style:{classes:"qtip-allow-overflow"}});$(["#event-action-menu-actions button:not(.js-dropdown)","#event-action-menu-actions a:not(.disabled)"].join(", ")).on("click",(function(){$("#event-action-menu-actions-target").qbubble("hide")}))},e.setupEventPersonsList=function(e){e=$.extend({hasNoAccountFilter:!1,hasNoRegistrationFilter:!1,hasNoBuiltinRolesFilter:!1},e);const i=setupSearchBox({itemHandle:"tr",listItems:"#event-participants-list tbody tr:not(.hidden)",term:"#search-input",state:"#filtering-state",placeholder:"#filter-placeholder"});enableIfChecked(".js-event-person-list",".select-row:visible",".js-event-person-list .js-requires-selected-row"),$(".js-event-person-list").closest(".ui-dialog").length&&$(".js-event-person-list [data-toggle=dropdown]").closest(".toolbar").dropdown(),$(".js-event-person-list [data-filter]").on("click",t),$(".js-event-person-list td").on("mouseenter",(function(){const e=$(this);this.offsetWidth<this.scrollWidth&&!e.attr("title")&&e.attr("title",e.text())})),$(".js-event-person-list .tablesorter").tablesorter({cssAsc:"header-sort-asc",cssDesc:"header-sort-desc",headerTemplate:"",sortList:[[1,0]]});const l=$(".js-event-person-list .roles-column > span");l.qbubble({show:{event:"mouseover"},hide:{fixed:!0,delay:100,event:"mouseleave"},position:{my:"left center",at:"right center"},content:{text(){const e=$(this),t=$("<div>"),n=$("<strong>",{text:$(this).data("role-name")});if(t.append(n),e.is(".js-count-label")){const n=$("<ul>",{class:"qbubble-item-list"}),a=s()(e.data("items")).sort((function(e,t){return(0,o.U)(e.title.toLowerCase(),t.title.toLowerCase())}));$.each(a,(function(){const e=$("<li>");this.url?e.append($("<a>",{text:this.title,href:this.url})):e.text(this.title),n.append(e)})),t.append(n)}return t}}}),l.filter(".custom").each((function(){const e=$(this);e.css("background-color",$.Color(e.css("color")).alpha(.1))})),e.hasNoAccountFilter&&($(".js-event-person-list [data-filter]:not(#filter-no-account)").on("change",(function(){$("#filter-no-account").prop("checked",!1),t(),i()})),$("#filter-no-account").on("change",(function(){this.checked&&$(".js-event-person-list [data-filter]:checked:not(#filter-no-account)").prop("checked",!1),t(),i()}))),e.hasNoRegistrationFilter&&($(".js-event-person-list [data-filter]:not(#filter-no-registration)").on("change",(function(){$("#filter-no-registration").prop("checked",!1),t(),i()})),$("#filter-no-registration").on("change",(function(){this.checked&&$(".js-event-person-list [data-filter]:checked:not(#filter-no-registration)").prop("checked",!1),t(),i()}))),e.hasNoBuiltinRolesFilter&&($(".js-event-person-list [data-filter]:not(#filter-no-builtin-roles)").on("change",(function(){$("#filter-no-builtin-roles").prop("checked",!1),t(),i()})),$("#filter-no-builtin-roles").on("change",(function(){this.checked&&$(".js-event-person-list [data-filter]:checked:not(#filter-no-builtin-roles)").prop("checked",!1),t(),i()}))),a();const r=$("#person-filters");r.find("li .colored-square").each((function(){const e=$(this);e.closest("li").css("background-color",$.Color(e.css("color")).alpha(.1))})),r.find(".js-reset-role-filter").on("click",(function(){$(".js-event-person-list [data-filter]").each((function(){const e=$(this);e.prop("checked",!1),e.parent().toggleClass("enabled",!1)})),t(),i(),n()})),r.find("li label").on("click",(function(e){e.preventDefault()})),r.find("li").on("click",(function(){const e=$(this).find("[data-filter]");e.prop("checked",!e.prop("checked")).trigger("change"),n()})),$("#event-participants-list").on("indico:htmlUpdated",a)},e.showUndoWarning=function(e,t,n){cornerMessage({message:e,progressMessage:r.$T.gettext("Undoing previous operation..."),feedbackMessage:t,actionLabel:r.$T.gettext("Undo"),actionCallback:n,duration:1e4,feedbackDuration:4e3,class:"warning"})},e.handleSelectedRowHighlight=function(e){const t=$("table.i-table input.select-row").on("change",(function(){$(this).closest("tr").toggleClass("selected",this.checked)}));e&&t.trigger("change")},e.showThemeSettingsForm=function(e){e=$.extend(!0,{formUrl:null,themeFieldId:null,lastFieldId:null},e),$(`#${e.themeFieldId}`).on("change",(function(){$.ajax({url:e.formUrl,data:{theme:$(this).val()},complete:IndicoUI.Dialogs.Util.progress(),error:handleAjaxError,success(t){const n=$(`#${e.lastFieldId}`);n.nextAll(":not(.form-group-footer)").remove(),t.html&&n.after(t.html),t.js&&$("body").append(t.js)}})}))}}(window)}},e=>{e.O(0,[5514,3044,8592],(()=>{return t=28862,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_events.management.904e1f03.bundle.js.map