"use strict";(self.webpackChunkpaper_admin=self.webpackChunkpaper_admin||[]).push([[9010],{3422:function(t,e,r){r.r(e);var o=r(4827),s=r(4027),n=r(2209),i=r(6358),a=r(9127);const m='input[name$="-TOTAL_FORMS"]',l='input[name$="-INITIAL_FORMS"]',d='input[name$="-MIN_NUM_FORMS"]',h='input[name$="-MAX_NUM_FORMS"]';var c=class{constructor(t){this.root=t}get totalForms(){const t=this.root.querySelector(m);return parseInt(t.value.toString())}set totalForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(m).value=e}get initialForms(){const t=this.root.querySelector(l);return parseInt(t.value.toString())}set initialForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(l).value=e}get minForms(){const t=this.root.querySelector(d);return t?parseInt(t.value.toString()):0}set minForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(d).value=e}get maxForms(){const t=this.root.querySelector(h);return t?parseInt(t.value.toString()):1/0}set maxForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(h).value=e}};var u=class{constructor(t){this.root=t,this.management_form=new c(t),this._initAddFormButtons(),this._initDeleteFormButtons(),this._initSortFormButtons(),this.updateFormIndexes()}get prefix(){const t=this.root.dataset.formsetPrefix;if(!t)throw new Error("formset prefix required");return t}get formContainer(){const t=this.root.dataset.formsetFormContainer;if(!t)throw new Error("container selector required");const e=this.root.querySelector(t);if(!e)throw new Error("container not found");return e}get formSelector(){const t=this.root.dataset.formsetFormSelector;if(!t)throw new Error("form selector required");return t}get templateId(){const t=this.root.dataset.formsetFormTemplate;if(!t)throw new Error("form template ID required");return t}get formTemplate(){const t=document.getElementById(this.templateId);if(!t)throw new Error("form template element not found");return t}getForms(){return this.formContainer.querySelectorAll(this.formSelector)}getFormIndex(t){return Array.from(this.getForms()).indexOf(t)}getAddFormButtons(){const t=[];return document.querySelectorAll('[data-formset-toggle="add"]').forEach((e=>{(this.root.id&&e.dataset.formset===this.root.id||this.root.contains(e)&&!e.dataset.formset)&&t.push(e)})),t}getDeleteFormButtons(){let t=[];return this.getForms().forEach((e=>{const r=e.querySelectorAll('[data-formset-toggle="delete"]');r.length&&(t=t.concat(Array.from(r)))})),t}getSortFormButtons(){let t=[];return this.getForms().forEach((e=>{const r=e.querySelectorAll('[data-formset-toggle="up"]');r.length&&(t=t.concat(Array.from(r)));const o=e.querySelectorAll('[data-formset-toggle="down"]');o.length&&(t=t.concat(Array.from(o)))})),t}hasOriginal(t){return t.classList.contains("has_original")}setAddFormButtonState(t,e){t.disabled=!e}setDeleteFormButtonState(t,e){t.disabled=!e}setSortFormButtonState(t,e){t.disabled=!e}_initAddFormButtons(){document.addEventListener("click",(t=>{const e=t.target.closest('[data-formset-toggle="add"]');e&&(this.root.id&&e.dataset.formset===this.root.id||this.root.contains(e)&&!e.dataset.formset)&&this.addForm()}))}_initDeleteFormButtons(){document.addEventListener("click",(t=>{const e=t.target.closest('[data-formset-toggle="delete"]');if(e&&this.root.contains(e)){const t=e.closest(this.formSelector);t&&this.deleteForm(t)}}))}_initSortFormButtons(){document.addEventListener("click",(t=>{const e=t.target.closest('[data-formset-toggle="up"]'),r=t.target.closest('[data-formset-toggle="down"]');if(e&&this.root.contains(e)){const t=e.closest(this.formSelector);t&&this.moveFormUp(t)}else if(r&&this.root.contains(r)){const t=r.closest(this.formSelector);t&&this.moveFormDown(t)}}))}addForm(){if(this.management_form.totalForms>=this.management_form.maxForms)throw new Error("Maximum number of forms is reached");const t=this.formTemplate.content.cloneNode(!0),e=t.children[0];return this.formContainer.appendChild(t),this.management_form.totalForms++,this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState(),e}deleteForm(t){if(this.management_form.totalForms<=this.management_form.minForms)throw new Error("Minimum number of forms is reached");this.management_form.totalForms--,t.remove(),this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState()}moveFormUp(t){const e=this.getFormIndex(t);if(0===e)throw new Error("form is already first");const r=this.getForms()[e-1];t.after(r),this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState()}moveFormDown(t){const e=this.getForms().length,r=this.getFormIndex(t);if(r===e-1)throw new Error("form is already last");const o=this.getForms()[r+1];t.before(o),this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState()}updateFormIndexes(t){void 0===t&&(t=null);let e=0;this.getForms().forEach((r=>{r!==t&&this.hasOriginal(r)&&this.setFormIndex(r,e++)})),this.getForms().forEach((r=>{r===t||this.hasOriginal(r)||this.setFormIndex(r,e++)}))}setFormIndex(t,e){this._setElementIndex(t,e),t.querySelectorAll("*").forEach((t=>{this._setElementIndex(t,e)}))}_setElementIndex(t,e){const r=new RegExp("("+this.prefix+"-(\\d+|__prefix__))"),o=this.prefix+"-"+e;t.htmlFor&&(t.htmlFor=t.htmlFor.replace(r,o)),t.id&&(t.id=t.id.replace(r,o)),t.name&&(t.name=t.name.replace(r,o))}updateFormOrder(t){void 0===t&&(t=null);let e=0;this.getForms().forEach((r=>{r!==t&&this.setFormOrder(r,e++)}))}setFormOrder(t,e){}updateButtonsState(){const t=this.management_form.totalForms>=this.management_form.maxForms;this.getAddFormButtons().forEach((e=>{this.setAddFormButtonState(e,!t)}));const e=this.management_form.totalForms<=this.management_form.minForms;this.getDeleteFormButtons().forEach((t=>{this.setDeleteFormButtonState(t,!e)}));const r=this.getForms().length;this.getSortFormButtons().forEach((t=>{const e=t.closest(this.formSelector),o=this.getFormIndex(e),s=t.dataset.formsetToggle;let n=!0;0===o&&"up"===s&&(n=!1),o===r-1&&"down"===s&&(n=!1),this.setSortFormButtonState(t,n)}))}};i.p8.registerPlugin(a.L);var g=class extends u{constructor(t){super(t),this._isTransitioning=!1}get isTabular(){return this.root.classList.contains("paper-formset--tabular")}setAddFormButtonState(t,e){const r=!this._isTransitioning&&e;super.setAddFormButtonState(t,r),t.classList.toggle("disabled",!r)}setDeleteFormButtonState(t,e){const r=!this._isTransitioning&&e;super.setDeleteFormButtonState(t,r),t.classList.toggle("disabled",!r)}setSortFormButtonState(t,e){const r=!this._isTransitioning&&e;super.setSortFormButtonState(t,r),t.classList.toggle("disabled",!r)}addForm(){this._isTransitioning=!0;const t=super.addForm();n.Z.dom.trigger("mutate",[t]),n.Z.inlines.trigger("add",[t,this.prefix]);const e={onComplete:()=>{this._isTransitioning=!1,this.updateButtonsState(),n.Z.inlines.trigger("added",[t,this.prefix]),$(document).trigger("formset:added",[$(t),this.prefix])}};return this.isTabular?(e.duration=.2,e.opacity=0,e.clearProps="opacity"):(e.duration=.3,e.height=0,e.clearProps="height"),i.p8.from(t,e),t}deleteForm(t){if(this.management_form.totalForms<=this.management_form.minForms)throw new Error("Minimum number of forms is reached");this.management_form.totalForms--,this.setFormIndex(t,this.management_form.totalForms),this.updateFormIndexes(t),this.updateFormOrder(t),n.Z.inlines.trigger("remove",[t,this.prefix]),this._isTransitioning=!0,this.updateButtonsState();const e={onComplete:()=>{n.Z.dom.trigger("release",[t]),t.remove(),this._isTransitioning=!1,this.updateButtonsState(),n.Z.inlines.trigger("removed",[t,this.prefix]),$(document).trigger("formset:removed",[$(t),this.prefix])}};this.isTabular?(e.duration=.2,e.opacity=0):(e.duration=.3,e.height=0),i.p8.to(t,e)}moveFormUp(t){const e=this.getFormIndex(t);if(0===e)throw new Error("the form is first already");const r=this.getForms()[e-1];this._swapForms(r,t,"up")}moveFormDown(t){const e=this.getForms().length,r=this.getFormIndex(t);if(r===e-1)throw new Error("the form is last already");const o=this.getForms()[r+1];this._swapForms(t,o,"down")}_swapForms(t,e,r){const o=t.getBoundingClientRect(),s=e.getBoundingClientRect(),n=window.scrollY;e.after(t),window.scrollTo(0,n);const a=t.getBoundingClientRect(),m=e.getBoundingClientRect();this.updateFormIndexes(),this.updateFormOrder(),this.formContainer.style.transformStyle="preserve-3d","up"===r?(t.style.transform=`translate3d(0, ${o.top-a.top}px, 0)`,e.style.transform=`translate3d(0, ${s.top-m.top}px, 1px)`):(t.style.transform=`translate3d(0, ${o.top-a.top}px, 1px)`,e.style.transform=`translate3d(0, ${s.top-m.top}px, 0)`),this._isTransitioning=!0,this.updateButtonsState();const l={y:0,clearProps:"transform"};this.isTabular?l.duration=.25:l.duration=.5;const d=i.p8.timeline({onComplete:()=>{this._isTransitioning=!1,this.updateButtonsState(),this.formContainer.style.transformStyle=""}}).to(t,l).to(e,l,0);let h,c;"up"===r?(h=n+(m.top-s.top),c=s.top>.5*window.innerHeight&&m.top>.5*window.innerHeight):(h=n+(a.top-o.top),c=o.top<.5*window.innerHeight&&a.top<.5*window.innerHeight),c||d.to(window,{duration:l.duration,scrollTo:{y:Math.max(0,h)}},0)}setFormOrder(t,e){super.setFormOrder(t,e);const r=t.querySelector(".paper-formset__order");r&&(r.value=e)}setFormIndex(t,e){super.setFormIndex(t,e);const r=t.querySelector(".paper-formset__form-caption");r&&(r.innerHTML=r.innerHTML.replace(/#(\d+|__prefix__)/g,"#"+(e+1)));const o=t.querySelector('[data-formset-toggle="delete"]');if(o&&o.dataset.formsetForm){const t=new RegExp("("+this.prefix+"-(\\d+|__prefix__))"),r=this.prefix+"-"+e,s=o.dataset.formsetForm.replace(t,r);o.setAttribute("data-formset-form",s)}}};i.p8.registerPlugin(a.L),document.addEventListener("click",(t=>{t.target.closest(".scroll-top-button")&&i.p8.to(window,{duration:.3,scrollTo:{y:0}})})),window.addEventListener("scroll",(()=>{const t=document.querySelector(".scroll-top-button");t&&t.classList.toggle("show",window.scrollY>=.75*document.documentElement.clientHeight)}));const f=new s.C({width:"",allowClear:!0});f.observe(".select-field select"),f.initAll(".select-field select");let p=[];document.querySelectorAll(".paper-formset").forEach((t=>{const e=new g(t);e.updateButtonsState(),p.push(e)}));let F=!1;const w=document.querySelector(".paper-form");w&&w.addEventListener("submit",(t=>{if(!F)return void(F=!0);t.preventDefault();window.confirm(gettext("You have already submitted this form. Are you sure you want to submit it again?"))&&t.target.submit()})),document.addEventListener("submit",(()=>{p.forEach((t=>{let e=0;t.getForms().forEach((r=>{(r.classList.contains("has_original")||o.Z.containsChangedField(r))&&t.setFormOrder(r,e++)}))}))}))}}]);
//# sourceMappingURL=changeform.06b8dc27e50652df0719.js.map