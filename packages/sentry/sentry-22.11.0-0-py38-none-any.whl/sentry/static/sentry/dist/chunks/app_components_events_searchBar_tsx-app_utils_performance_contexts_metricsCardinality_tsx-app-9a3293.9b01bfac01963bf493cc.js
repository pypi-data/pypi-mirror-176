"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_events_searchBar_tsx-app_utils_performance_contexts_metricsCardinality_tsx-app-9a3293"],{"./app/components/events/searchBar.tsx":(e,t,n)=>{n.d(t,{Z:()=>A}),n("../node_modules/core-js/modules/es.error.cause.js"),n("../node_modules/core-js/modules/es.array.includes.js");var s=n("../node_modules/react/index.js"),r=n("../node_modules/@sentry/browser/node_modules/@sentry/core/esm/exports.js"),o=n("../node_modules/lodash/assign.js"),a=n.n(o),i=n("../node_modules/lodash/flatten.js"),c=n.n(i),l=n("../node_modules/lodash/memoize.js"),d=n.n(l),u=n("../node_modules/lodash/omit.js"),p=n.n(u),m=n("./app/actionCreators/tags.tsx"),h=n("./app/components/smartSearchBar/index.tsx"),g=n("./app/constants/index.tsx"),f=n("./app/types/index.tsx"),y=n("./app/utils.tsx"),b=n("./app/utils/discover/fields.tsx"),v=n("./app/utils/fields/index.ts"),x=n("./app/utils/measurements/measurements.tsx"),j=n("./app/utils/useApi.tsx"),T=n("./app/utils/withTags.tsx"),Z=n("./app/views/dashboardsV2/utils.tsx"),S=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const _=new RegExp(`^${g.c$}|\\${g.ir}`,"g"),w=new Set(Object.keys(b.wZ)),C=Object.keys(b.wZ).reduce(((e,t)=>(e[t]={...b.wZ[t],kind:v.IV.FIELD},e)),{}),k=p()(C,b.J8),P=b.$4.reduce(((e,t)=>(e[t]={name:t,kind:v.IV.METRICS},e)),{}),O=Object.keys(b.jg).reduce(((e,t)=>(e[t]={...b.jg[t],kind:v.IV.FIELD},e)),{});function N(e){const{maxSearchItems:t,organization:n,tags:o,omitTags:i,fields:l,projectIds:u,includeSessionTagsValues:g,maxMenuHeight:T,customMeasurements:N}=e,A=(0,j.Z)(),I=(0,s.useRef)(!1),q=(0,s.useMemo)((()=>(e=>e?.length?e.reduce(((e,t)=>(w.has(t.field)||(0,b.GO)(t.field)||(0,Z.nk)(t.field)||(e[t.field]={key:t.field,name:t.field,kind:v.IV.FUNCTION}),e)),{}):[])(l)),[l]),E=(0,s.useMemo)((()=>Object.keys(o).reduce(((e,t)=>(e[t]={...o[t],kind:v.IV.TAG},e)),{})),[o]);(0,s.useEffect)((()=>{M.cache.clear?.()}),[u]);const M=d()(((e,t,s)=>{const r=u?.map(String);return(0,b.h1)(e.key)||(0,b.Xr)(e.key)?Promise.resolve([]):(0,m.Fo)({api:A,orgSlug:n.slug,tagKey:e.key,search:t,projectIds:r,endpointParams:s,includeTransactions:!0,includeSessions:g}).then((e=>c()(e.filter((e=>{let{name:t}=e;return(0,y.ri)(t)})).map((e=>{let{name:t}=e;return t})))),(()=>{throw new Error("Unable to fetch event field values")}))}),((e,t)=>{let{key:n}=e;return`${n}-${t}`})),$=e=>{let t;!I.current&&Object.keys(o).length>0&&(t=r.Yr({name:"SearchBar.getTagList"}),I.current=!0);const s=((e,t)=>{const n=Object.keys(e).reduce(((t,n)=>(t[n]={...e[n],kind:v.IV.MEASUREMENT},t)),{});return t?Object.keys(t).reduce(((e,n)=>(e[n]={...t[n],kind:v.IV.MEASUREMENT},e)),n):n})(e,N),c=n.features.includes("performance-view")?Object.assign({},s,q,P,C):Object.assign({},k);a()(c,E,C,O),c.has={key:v.Sh.HAS,name:"Has property",values:Object.keys(c).sort(((e,t)=>e.toLowerCase().localeCompare(t.toLowerCase()))),predefined:!0,kind:v.IV.FIELD};const l=i&&i.length>0?p()(c,i):c;if(t){const e=Object.keys(l).length;t.setTag("tags.totalCount",e);const n=[1,5,10,20,50,100,200,300,400,500,600,700,800,900,1e3,1e4].find((t=>e<=t));t.setTag("tags.totalCount.grouped",`<=${n}`),t.finish()}return l};return(0,S.tZ)(x.Z,{children:n=>{let{measurements:s}=n;return(0,S.tZ)(h.Z,{hasRecentSearches:!0,savedSearchType:f.L4.EVENT,onGetTagValues:M,supportedTags:$(s),prepareQuery:e=>e.replace(_,""),maxSearchItems:t,excludedTags:["environment"],maxMenuHeight:T??300,customPerformanceMetrics:N,...e})}})}N.displayName="SearchBar";const A=(0,T.Z)(N)},"./app/utils/performance/contexts/metricsCardinality.tsx":(e,t,n)=>{n.d(t,{BT:()=>x,e0:()=>T}),n("../node_modules/core-js/modules/es.array.includes.js");var s=n("../node_modules/react/index.js"),r=n("./app/utils/analytics/trackAdvancedAnalyticsEvent.tsx"),o=n("./app/utils/dates.tsx"),a=n("./app/utils/discover/eventView.tsx"),i=n("./app/utils/performance/contexts/metricsEnhancedSetting.tsx"),c=n("../node_modules/lodash/omit.js"),l=n.n(c),d=n("./app/utils/discover/genericDiscoverQuery.tsx"),u=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){let{eventView:t,location:n}=e;return l()(t.getEventsAPIPayload(n),["field","sort","per_page","query"])}function m(e){let{children:t,...n}=e;return(0,u.tZ)(d.ZP,{route:"metrics-compatibility-sums",getRequestPayload:p,...n,children:e=>{let{tableData:n,...s}=e;return t({tableData:n,...s})}})}function h(e){let{eventView:t,location:n}=e;return l()(t.getEventsAPIPayload(n),["field","sort","per_page","query"])}function g(e){let{children:t,...n}=e;return(0,u.tZ)(d.ZP,{route:"metrics-compatibility",getRequestPayload:h,...n,children:e=>{let{tableData:n,...s}=e;return t({tableData:n,...s})}})}m.displayName="MetricsCompatibilityQuery",g.displayName="MetricsCompatibilitySumsQuery";var f=n("./app/utils/performance/contexts/utils.tsx");const[y,b,v]=(0,f.n)({name:"MetricsCardinalityContext",strict:!1}),x=e=>{if(!(0,i.gp)(e.organization))return(0,u.tZ)(y,{value:{isLoading:!1,outcome:{forceTransactionsOnly:!0}},children:e.children});const t={location:e.location,orgSlug:e.organization.slug,cursor:"0:0:0"},n=a.ZP.fromLocation(e.location);n.fields=[{field:"tpm()"}];const r=function(e){const t=e.clone();return t.start||t.end||(t.statsPeriod?(0,o.YJ)(t.statsPeriod)>1&&(t.statsPeriod="1h",t.start=void 0,t.end=void 0):(t.statsPeriod="1h",t.start=void 0,t.end=void 0)),t}(n);return(0,u.tZ)(s.Fragment,{children:(0,u.tZ)(m,{eventView:r,...t,children:n=>(0,u.tZ)(g,{eventView:r,...t,children:t=>{const s=n.isLoading||t.isLoading,r=n.isLoading||t.isLoading?void 0:function(e,t,n){const s={forceTransactionsOnly:!0},r=n.features.includes("performance-mep-bannerless-ui");if(!e)return s;const o=e.compatible_projects;return t?s:e?function(e){return!Z(e).metricsCount}(e)?s:function(e,t){const n=Z(e);return t?n.nullCount/n.metricsCount>.01:n.nullCount>0}(e,r)?{shouldWarnIncompatibleSDK:!0,forceTransactionsOnly:!0,compatibleProjects:o}:function(e){const t=Z(e);return t.unparamCount>=t.metricsCount}(e)?{shouldNotifyUnnamedTransactions:!0,forceTransactionsOnly:!0,compatibleProjects:o}:function(e,t){const n=Z(e);return t?n.unparamCount/n.metricsCount>.01:n.unparamCount>0}(e,r)?{shouldNotifyUnnamedTransactions:!0,compatibleProjects:o,forceTransactionsOnly:!1}:{forceTransactionsOnly:!1}:s}(n.tableData&&t.tableData?{...n.tableData,...t.tableData}:null,!!n.error&&!!t.error,e.organization);return(0,u.tZ)(j,{sendOutcomeAnalytics:e.sendOutcomeAnalytics,organization:e.organization,value:{isLoading:s,outcome:r},children:e.children})}})})})};x.displayName="MetricsCardinalityProvider";const j=e=>{const t=e.value.outcome?.shouldWarnIncompatibleSDK??!1,n=e.value.outcome?.shouldNotifyUnnamedTransactions??!1,o=!e.value.outcome?.forceTransactionsOnly;return(0,s.useEffect)((()=>{!e.value.isLoading&&e.sendOutcomeAnalytics&&(0,r.Z)("performance_views.mep.metrics_outcome",{organization:e.organization,is_on_metrics:o,fallback_from_null:t,fallback_from_unparam:n})}),[e.organization,e.value.isLoading,o,n,t,e.sendOutcomeAnalytics]),(0,u.tZ)(y,{...e,children:e.children})};j.displayName="Provider",v.Consumer;const T=b;function Z(e){let{sum:t}=e;try{const e=Number(t.metrics);return{metricsCount:e,unparamCount:Number(t.metrics_unparam),nullCount:Number(t.metrics_null)}}catch(e){return{metricsCount:0,unparamCount:0,nullCount:0}}}},"./app/utils/performance/histogram/utils.tsx":(e,t,n)=>{n.d(t,{GT:()=>a,_W:()=>o,te:()=>r}),n("../node_modules/core-js/modules/es.error.cause.js");var s=n("./app/utils/formatters.tsx");function r(e){return e.length>=2?e[1].bin-e[0].bin:0}function o(e){const t=r(e);return e.map((e=>{const n=e.bin;return{start:n,end:n+t}}))}function a(e){let{precision:t,type:n,additionalFieldsFn:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=e=>{switch(n){case"duration":const r=t??(e<1e3?0:3);return(0,s.g9)(e/1e3,r,!0);case"number":const o=10**(t??0);return(Math.round((e+Number.EPSILON)*o)/o).toLocaleString();default:throw new Error(`Unable to format type: ${n}`)}};return e.map((e=>({value:e.count,name:o(e.bin),...r?.(e.bin)??{}})))}},"./app/utils/withTags.tsx":(e,t,n)=>{n.d(t,{Z:()=>c});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("../node_modules/react/index.js"),o=n("./app/stores/tagStore.tsx"),a=n("./app/utils/getDisplayName.tsx"),i=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const c=function(e){class t extends r.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{tags:o.Z.getState()}),(0,s.Z)(this,"unsubscribe",o.Z.listen((e=>this.setState({tags:e})),void 0))}componentWillUnmount(){this.unsubscribe()}render(){const{tags:t,...n}=this.props;return(0,i.tZ)(e,{tags:t??this.state.tags,...n})}}return t.displayName="WithTags",(0,s.Z)(t,"displayName",`withTags(${(0,a.Z)(e)})`),t}},"./app/views/performance/transactionSummary/transactionEvents/utils.tsx":(e,t,n)=>{n.d(t,{Kc:()=>m,Lc:()=>h,Zq:()=>p,_S:()=>c,q3:()=>i,qg:()=>u,tb:()=>d,xr:()=>l}),n("../node_modules/core-js/modules/es.array.includes.js");var s=n("./app/locale.tsx"),r=n("./app/utils/queryString.tsx"),o=n("./app/views/performance/transactionSummary/filter.tsx"),a=n("./app/views/performance/transactionSummary/utils.tsx");let i;function c(e,t){const{p99:n,p95:r,p75:a,p50:c}=t||{p99:0,p95:0,p75:0,p50:0};return{[i.p50]:{name:i.p50,query:c?[["transaction.duration",`<=${c.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,o.T$)(e)||"transaction.duration"},label:(0,s.t)("p50")},[i.p75]:{name:i.p75,query:a?[["transaction.duration",`<=${a.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,o.T$)(e)||"transaction.duration"},label:(0,s.t)("p75")},[i.p95]:{name:i.p95,query:r?[["transaction.duration",`<=${r.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,o.T$)(e)||"transaction.duration"},label:(0,s.t)("p95")},[i.p99]:{name:i.p99,query:n?[["transaction.duration",`<=${n.toFixed(0)}`]]:void 0,sort:{kind:"desc",field:(0,o.T$)(e)||"transaction.duration"},label:(0,s.t)("p99")},[i.p100]:{name:i.p100,label:(0,s.t)("p100")}}}function l(e){let{orgSlug:t,transaction:n,projectID:s,query:r}=e;return{pathname:`/organizations/${t}/performance/summary/events/`,query:{transaction:n,project:s,environment:r.environment,statsPeriod:r.statsPeriod,start:r.start,end:r.end,query:r.query}}}function d(e){return t=(0,r.ro)(e.query.showTransactions,i.p100),Object.values(i).includes(t)?t:i.p100;var t}function u(e,t){const n=c(t),s=n[e].sort?.kind,r=n[e].sort?.field,o={showTransactions:e};return s&&r&&(o.sort=`${"desc"===s?"-":""}${r}`),o}function p(e){switch(e){case a.K0.OUTLIER:return i.p100;case a.K0.SLOW:return i.p95;default:return}}function m(e){return{p100:e?.["p100()"],p99:e?.["p99()"],p95:e?.["p95()"],p75:e?.["p75()"],p50:e?.["p50()"]}}function h(e){return e.withColumns([{kind:"function",function:["p100","",void 0,void 0]},{kind:"function",function:["p99","",void 0,void 0]},{kind:"function",function:["p95","",void 0,void 0]},{kind:"function",function:["p75","",void 0,void 0]},{kind:"function",function:["p50","",void 0,void 0]}])}!function(e){e.p50="p50",e.p75="p75",e.p95="p95",e.p99="p99",e.p100="p100"}(i||(i={}))},"./app/views/performance/transactionSummary/transactionThresholdModal.tsx":(e,t,n)=>{n.d(t,{ZP:()=>P,fY:()=>k});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),r=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=n("../node_modules/react/index.js"),a=n("../node_modules/lodash/cloneDeep.js"),i=n.n(a),c=n("../node_modules/lodash/set.js"),l=n.n(c),d=n("./app/actionCreators/indicator.tsx"),u=n("./app/components/button.tsx"),p=n("./app/components/buttonBar.tsx"),m=n("./app/components/forms/controls/selectControl.tsx"),h=n("./app/components/forms/field/index.tsx"),g=n("./app/components/input.tsx"),f=n("./app/components/links/link.tsx"),y=n("./app/locale.tsx"),b=n("./app/styles/space.tsx"),v=n("./app/utils.tsx"),x=n("./app/utils/withApi.tsx"),j=n("./app/utils/withProjects.tsx"),T=n("./app/views/performance/transactionSummary/utils.tsx"),Z=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");let S;!function(e){e.TRANSACTION_DURATION="duration",e.LARGEST_CONTENTFUL_PAINT="lcp"}(S||(S={}));const _=[{label:(0,y.t)("Transaction Duration"),value:"duration"},{label:(0,y.t)("Largest Contentful Paint"),value:"lcp"}];class w extends o.Component{constructor(){super(...arguments),(0,s.Z)(this,"state",{threshold:this.props.transactionThreshold,metric:this.props.transactionThresholdMetric,error:null}),(0,s.Z)(this,"handleApply",(e=>{e.preventDefault();const{api:t,closeModal:n,organization:s,transactionName:r,onApply:o}=this.props,a=this.getProject();if(!(0,v.ri)(a))return;const i=`/organizations/${s.slug}/project-transaction-threshold-override/`;t.requestPromise(i,{method:"POST",includeAllArgs:!0,query:{project:a.id},data:{transaction:r,threshold:this.state.threshold,metric:this.state.metric}}).then((()=>{n(),o&&o(this.state.threshold,this.state.metric)})).catch((e=>{this.setState({error:e});const t=e.responseJSON?.threshold??e.responseJSON?.non_field_errors??null;(0,d.Iw)(t)}))})),(0,s.Z)(this,"handleFieldChange",(e=>t=>{this.setState((n=>{const s=i()(n);return l()(s,e,t),{...s,errors:void 0}}))})),(0,s.Z)(this,"handleReset",(e=>{e.preventDefault();const{api:t,closeModal:n,organization:s,transactionName:r,onApply:o}=this.props,a=this.getProject();if(!(0,v.ri)(a))return;const i=`/organizations/${s.slug}/project-transaction-threshold-override/`;t.requestPromise(i,{method:"DELETE",includeAllArgs:!0,query:{project:a.id},data:{transaction:r}}).then((()=>{const e=`/projects/${s.slug}/${a.slug}/transaction-threshold/configure/`;this.props.api.requestPromise(e,{method:"GET",includeAllArgs:!0,query:{project:a.id}}).then((e=>{let[t]=e;this.setState({threshold:t.threshold,metric:t.metric}),n(),o&&o(this.state.threshold,this.state.metric)})).catch((e=>{const t=e.responseJSON?.threshold??null;(0,d.Iw)(t)}))})).catch((e=>{this.setState({error:e})}))}))}getProject(){const{projects:e,eventView:t,project:n}=this.props;if((0,v.ri)(n))return e.find((e=>e.id===n));const s=String(t.project[0]);return e.find((e=>e.id===s))}renderModalFields(){return(0,Z.BX)(o.Fragment,{children:[(0,Z.tZ)(h.Z,{"data-test-id":"response-metric",label:(0,y.t)("Calculation Method"),inline:!1,help:(0,y.t)("This determines which duration metric is used for the Response Time Threshold."),showHelpInTooltip:!0,flexibleControlStateSize:!0,stacked:!0,required:!0,children:(0,Z.tZ)(m.Z,{required:!0,options:_.slice(),name:"responseMetric",label:(0,y.t)("Calculation Method"),value:this.state.metric,onChange:e=>{this.handleFieldChange("metric")(e.value)}})}),(0,Z.tZ)(h.Z,{"data-test-id":"response-time-threshold",label:(0,y.t)("Response Time Threshold (ms)"),inline:!1,help:(0,y.t)("The satisfactory response time for the calculation method defined above. This is used to calculate Apdex and User Misery scores."),showHelpInTooltip:!0,flexibleControlStateSize:!0,stacked:!0,required:!0,children:(0,Z.tZ)(g.Z,{type:"number",name:"threshold",required:!0,pattern:"[0-9]*(\\.[0-9]*)?",onChange:e=>{this.handleFieldChange("threshold")(e.target.value)},value:this.state.threshold,step:100,min:100})})]})}render(){const{Header:e,Body:t,Footer:n,organization:s,transactionName:r,eventView:a}=this.props,i=this.getProject(),c=a.clone();c.query=c.getQueryWithAdditionalConditions();const l=(0,T.e1)({orgSlug:s.slug,transaction:r,query:c.generateQueryStringObject(),projectID:i?.id});return(0,Z.BX)(o.Fragment,{children:[(0,Z.tZ)(e,{closeButton:!0,children:(0,Z.tZ)("h4",{children:(0,y.t)("Transaction Settings")})}),(0,Z.BX)(t,{children:[(0,Z.tZ)(C,{children:(0,y._N)("The changes below will only be applied to [transaction]. To set it at a more global level, go to [projectSettings: Project Settings].",{transaction:(0,Z.tZ)(f.Z,{to:l,children:r}),projectSettings:(0,Z.tZ)(f.Z,{to:`/settings/${s.slug}/projects/${i?.slug}/performance/`})})}),this.renderModalFields()]}),(0,Z.tZ)(n,{children:(0,Z.BX)(p.ZP,{gap:1,children:[(0,Z.tZ)(u.ZP,{priority:"default",onClick:this.handleReset,"data-test-id":"reset-all",children:(0,y.t)("Reset All")}),(0,Z.tZ)(u.ZP,{"aria-label":(0,y.t)("Apply"),priority:"primary",onClick:this.handleApply,"data-test-id":"apply-threshold",children:(0,y.t)("Apply")})]})})]})}}w.displayName="TransactionThresholdModal";const C=(0,r.Z)("div",{target:"ezg6l150"})("margin-bottom:",(0,b.Z)(4),";"),k={name:"9w3zq5",styles:"width:100%;max-width:650px;margin:70px auto"},P=(0,x.Z)((0,j.Z)(w))}}]);
//# sourceMappingURL=../sourcemaps/app_components_events_searchBar_tsx-app_utils_performance_contexts_metricsCardinality_tsx-app-9a3293.35e908f764672f460d7d1f5142b31a1a.js.map