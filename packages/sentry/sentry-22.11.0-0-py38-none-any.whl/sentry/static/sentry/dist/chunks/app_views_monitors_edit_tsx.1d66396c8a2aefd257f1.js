"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_monitors_edit_tsx"],{"./app/views/asyncView.tsx":(e,t,n)=>{n.d(t,{Z:()=>r});var i=n("./app/components/asyncComponent.tsx"),s=n("./app/components/sentryDocumentTitle.tsx"),o=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class r extends i.Z{getTitle(){return""}render(){return(0,o.tZ)(s.Z,{title:this.getTitle(),children:this.renderComponent()})}}r.displayName="AsyncView"},"./app/views/monitors/edit.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>d});var i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=n("../node_modules/react-router/es/index.js"),o=n("./app/components/layouts/thirds.tsx"),r=n("./app/locale.tsx"),l=n("./app/views/asyncView.tsx"),a=n("./app/views/monitors/monitorForm.tsx"),c=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class d extends l.Z{constructor(){super(...arguments),(0,i.Z)(this,"onUpdate",(e=>this.setState((t=>({monitor:{...t.monitor,...e}}))))),(0,i.Z)(this,"onSubmitSuccess",(e=>s.browserHistory.push(`/organizations/${this.props.params.orgId}/monitors/${e.id}/`)))}getEndpoints(){const{params:e}=this.props;return[["monitor",`/monitors/${e.monitorId}/`]]}getTitle(){return this.state.monitor?`${this.state.monitor.name} - Monitors - ${this.props.params.orgId}`:`Monitors - ${this.props.params.orgId}`}renderBody(){const{monitor:e}=this.state;return null===e?null:(0,c.tZ)(o.uT,{children:(0,c.BX)(o.or,{fullWidth:!0,children:[(0,c.tZ)("h1",{children:(0,r.t)("Edit Monitor")}),(0,c.tZ)(a.Z,{monitor:e,apiMethod:"PUT",apiEndpoint:`/monitors/${e.id}/`,onSubmitSuccess:this.onSubmitSuccess})]})})}}},"./app/views/monitors/monitorForm.tsx":(e,t,n)=>{n.d(t,{Z:()=>_});var i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=n("../node_modules/react/index.js"),o=n("../node_modules/mobx-react-lite/es/index.js"),r=n("./app/components/acl/access.tsx"),l=n("./app/components/forms/field/index.tsx"),a=n("./app/components/forms/fields/numberField.tsx"),c=n("./app/components/forms/fields/selectField.tsx"),d=n("./app/components/forms/fields/textField.tsx"),p=n("./app/components/forms/form.tsx"),m=n("./app/components/forms/model.tsx"),u=n("./app/components/panels/index.tsx"),h=n("./app/components/textCopyInput.tsx"),b=n("./app/locale.tsx"),f=n("./app/utils/withPageFilters.tsx"),g=n("./app/utils/withProjects.tsx"),x=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const Z=[{value:"crontab",label:"Crontab"},{value:"interval",label:"Interval"}],y=[{value:"cron_job",label:"Cron Job"}],w=[{value:"minute",label:"minute(s)"},{value:"hour",label:"hour(s)"},{value:"day",label:"day(s)"},{value:"week",label:"week(s)"},{value:"month",label:"month(s)"},{value:"year",label:"year(s)"}];function j(e,t){return t.fields.toJSON().reduce(((e,t)=>{let[n,i]=t;return 0!==n.indexOf("config.")?(e[n]=i,e):(e.config||(e.config={}),"config.schedule.frequency"!==n&&"config.schedule.interval"!==n||Array.isArray(e.config.schedule)||(e.config.schedule=[null,null]),"config.schedule.frequency"===n?e.config.schedule[0]=parseInt(i,10):"config.schedule.interval"===n?e.config.schedule[1]=i:e.config[n.substr(7)]=i,e)}),{})}class v extends s.Component{constructor(){super(...arguments),(0,i.Z)(this,"form",new m.Z({transformData:j}))}formDataFromConfig(e,t){const n={};return"cron_job"===e&&(n["config.schedule_type"]=t.schedule_type,n["config.checkin_margin"]=t.checkin_margin,n["config.max_runtime"]=t.max_runtime,"interval"===t.schedule_type?(n["config.schedule.frequency"]=t.schedule[0],n["config.schedule.interval"]=t.schedule[1]):n["config.schedule"]=t.schedule),n}render(){const{monitor:e,submitLabel:t}=this.props,n=this.props.selection.projects[0],i=n?this.props.projects.find((e=>e.id===n+"")):null;return(0,x.tZ)(r.Z,{access:["project:write"],children:n=>{let{hasAccess:r}=n;return(0,x.BX)(p.Z,{allowUndo:!0,requireChanges:!0,apiEndpoint:this.props.apiEndpoint,apiMethod:this.props.apiMethod,model:this.form,initialData:e?{name:e.name,type:e.type,project:e.project.slug,...this.formDataFromConfig(e.type,e.config)}:{project:i?i.slug:null},onSubmitSuccess:this.props.onSubmitSuccess,submitLabel:t,children:[(0,x.BX)(u.s_,{children:[(0,x.tZ)(u.V9,{children:(0,b.t)("Details")}),(0,x.BX)(u.N,{children:[e&&(0,x.tZ)(l.Z,{label:(0,b.t)("ID"),children:(0,x.tZ)("div",{className:"controls",children:(0,x.tZ)(h.ZP,{children:e.id})})}),(0,x.tZ)(c.Z,{name:"project",label:(0,b.t)("Project"),disabled:!r,options:this.props.projects.filter((e=>e.isMember)).map((e=>({value:e.slug,label:e.slug}))),help:(0,b.t)("Associate your monitor with the appropriate project."),required:!0}),(0,x.tZ)(d.Z,{name:"name",placeholder:(0,b.t)("My Cron Job"),label:(0,b.t)("Name"),disabled:!r,required:!0})]})]}),(0,x.BX)(u.s_,{children:[(0,x.tZ)(u.V9,{children:(0,b.t)("Config")}),(0,x.BX)(u.N,{children:[(0,x.tZ)(c.Z,{name:"type",label:(0,b.t)("Type"),disabled:!r,options:y,required:!0}),(0,x.tZ)(o.Qj,{children:()=>"cron_job"===this.form.getValue("type")?(0,x.BX)(s.Fragment,{children:[(0,x.tZ)(a.Z,{name:"config.max_runtime",label:(0,b.t)("Max Runtime"),disabled:!r,help:(0,b.t)("The maximum runtime (in minutes) a check-in is allowed before it's marked as a failure."),placeholder:"e.g. 30"}),(0,x.tZ)(c.Z,{name:"config.schedule_type",label:(0,b.t)("Schedule Type"),disabled:!r,options:Z,required:!0})]}):null}),(0,x.tZ)(o.Qj,{children:()=>{switch(this.form.getValue("config.schedule_type")){case"crontab":return(0,x.BX)(s.Fragment,{children:[(0,x.tZ)(d.Z,{name:"config.schedule",label:(0,b.t)("Schedule"),disabled:!r,placeholder:"*/5 * * * *",required:!0,help:(0,b._N)("Changes to the schedule will apply on the next check-in. See [link:Wikipedia] for crontab syntax.",{link:(0,x.tZ)("a",{href:"https://en.wikipedia.org/wiki/Cron"})})}),(0,x.tZ)(a.Z,{name:"config.checkin_margin",label:(0,b.t)("Check-in Margin"),disabled:!r,help:(0,b.t)("The margin (in minutes) a check-in is allowed to exceed it's scheduled window before being treated as missed."),placeholder:"e.g. 30"})]});case"interval":return(0,x.BX)(s.Fragment,{children:[(0,x.tZ)(a.Z,{name:"config.schedule.frequency",label:(0,b.t)("Frequency"),disabled:!r,placeholder:"e.g. 1",help:(0,b.t)("The amount of times you expect the cron job to run within the specified interval."),required:!0}),(0,x.tZ)(c.Z,{name:"config.schedule.interval",label:(0,b.t)("Interval"),disabled:!r,options:w,help:(0,b.t)("The interval on which the frequency will be applied. X times an (hour, day, week...)"),required:!0}),(0,x.tZ)(a.Z,{name:"config.checkin_margin",label:(0,b.t)("Check-in Margin"),disabled:!r,help:(0,b.t)("The margin (in minutes) a check-in is allowed to exceed it's scheduled window before being treated as missed."),placeholder:"e.g. 30"})]});default:return null}}})]})]})]})}})}}v.displayName="MonitorForm";const _=(0,f.Z)((0,g.Z)(v))}}]);
//# sourceMappingURL=../sourcemaps/app_views_monitors_edit_tsx.9939a592774f4db274084248bb67ff8d.js.map