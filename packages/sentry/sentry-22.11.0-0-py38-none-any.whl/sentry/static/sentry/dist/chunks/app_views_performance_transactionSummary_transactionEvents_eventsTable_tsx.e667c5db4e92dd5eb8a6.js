"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_performance_transactionSummary_transactionEvents_eventsTable_tsx"],{"./app/views/performance/transactionSummary/transactionEvents/eventsTable.tsx":(e,t,n)=>{n.d(t,{Z:()=>W});var i=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),s=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=(n("../node_modules/core-js/modules/es.array.includes.js"),n("../node_modules/react/index.js")),r=n("../node_modules/react-router/es/index.js"),a=n("../node_modules/lodash/groupBy.js"),l=n.n(a),d=n("./app/api.tsx"),p=n("./app/components/gridEditable/index.tsx"),c=n("./app/components/gridEditable/sortLink.tsx"),m=n("./app/components/links/link.tsx"),u=n("./app/components/pagination.tsx"),h=n("./app/components/questionTooltip.tsx"),g=n("./app/components/tooltip.tsx"),f=n("./app/locale.tsx"),v=n("./app/utils.tsx"),b=n("./app/utils/analytics.tsx"),y=n("./app/utils/discover/discoverQuery.tsx"),x=n("./app/utils/discover/eventView.tsx"),Z=n("./app/utils/discover/fieldRenderers.tsx"),w=n("./app/utils/discover/fields.tsx"),C=n("./app/utils/parseLinkHeader.tsx"),k=n("./app/views/eventsV2/table/cellAction.tsx"),S=n("./app/views/performance/data.tsx"),E=n("./app/views/performance/transactionSummary/utils.tsx"),z=n("../node_modules/react-dom/profiling.js"),_=n("../node_modules/react-popper/lib/esm/Popper.js"),O=n("../node_modules/react-popper/lib/esm/Manager.js"),j=n("../node_modules/react-popper/lib/esm/Reference.js"),M=n("./app/components/menuItem.tsx"),A=n("./app/components/radio.tsx"),B=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class L extends o.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{isOpen:!1}),(0,i.Z)(this,"menuEl",null),(0,i.Z)(this,"handleClickOutside",(e=>{this.menuEl&&e.target instanceof Element&&(this.menuEl.contains(e.target)||this.setState({isOpen:!1}))})),(0,i.Z)(this,"toggleOpen",(()=>{this.setState((e=>{let{isOpen:t}=e;return{isOpen:!t}}))}))}componentDidUpdate(e,t){this.state.isOpen&&!1===t.isOpen&&document.addEventListener("click",this.handleClickOutside,!0),!1===this.state.isOpen&&t.isOpen&&document.removeEventListener("click",this.handleClickOutside,!0)}componentWillUnmount(){document.removeEventListener("click",this.handleClickOutside,!0)}generateSortLink(e){const{eventView:t,tableMeta:n,location:i}=this.props;if(!n)return;const s=t.sortOnField(e,n,"desc").generateQueryStringObject();return{...i,query:{...i.query,sort:s.sort}}}renderMenuItem(e,t){const{eventView:n}=this.props;return(0,B.tZ)(I,{children:(0,B.tZ)(H,{children:(0,B.BX)(R,{children:[(0,B.tZ)(V,{readOnly:!0,radioSize:"small",checked:n.sorts.some((t=>{let{field:n}=t;return n===e})),onClick:()=>{const t=this.generateSortLink({field:e});t&&r.browserHistory.push(t)}}),(0,B.tZ)("span",{children:t})]})})})}renderMenuContent(){return(0,B.BX)(q,{children:[this.renderMenuItem("spans.http",(0,f.t)("Sort By HTTP")),this.renderMenuItem("spans.db",(0,f.t)("Sort By DB")),this.renderMenuItem("spans.resource",(0,f.t)("Sort By Resource")),this.renderMenuItem("spans.browser",(0,f.t)("Sort By Browser"))]})}renderMenu(){return(0,z.createPortal)((0,B.tZ)(_.r,{placement:"top",modifiers:[{name:"hide",enabled:!1},{name:"preventOverflow",enabled:!0,options:{padding:10}}],children:e=>{let{ref:t,style:n,placement:i}=e;return(0,B.tZ)(T,{ref:e=>{t(e),this.menuEl=e},style:n,"data-placement":i,children:this.renderMenuContent()})}}),document.body)}render(){const{title:e}=this.props,{isOpen:t}=this.state,n=t?this.renderMenu():null;return(0,B.BX)(O.dK,{children:[(0,B.tZ)(j.s,{children:t=>{let{ref:n}=t;return(0,B.tZ)(D,{ref:n,children:(0,B.tZ)(e,{onClick:this.toggleOpen})})}}),n]})}}L.displayName="OperationSort";const T=(0,s.Z)("div",{target:"e1pnio0z6"})("border:none;border-radius:2px;box-shadow:0 0 0 1px rgba(52, 60, 69, 0.2),0 1px 3px rgba(70, 82, 98, 0.25);background-clip:padding-box;background-color:",(e=>e.theme.background),";width:220px;overflow:visible;z-index:",(e=>e.theme.zIndex.tooltip),";&:before,&:after{width:0;height:0;content:'';display:block;position:absolute;right:auto;}&:before{border-left:9px solid transparent;border-right:9px solid transparent;left:calc(50% - 9px);z-index:-2;}&:after{border-left:8px solid transparent;border-right:8px solid transparent;left:calc(50% - 8px);z-index:-1;}&[data-placement*='bottom']{margin-top:9px;&:before{border-bottom:9px solid ",(e=>e.theme.border),";top:-9px;}&:after{border-bottom:8px solid ",(e=>e.theme.background),";top:-8px;}}&[data-placement*='top']{margin-bottom:9px;&:before{border-top:9px solid ",(e=>e.theme.border),";bottom:-9px;}&:after{border-top:8px solid ",(e=>e.theme.background),";bottom:-8px;}}"),I=(0,s.Z)(M.Z,{target:"e1pnio0z5"})("font-size:",(e=>e.theme.fontSizeMedium),";&:not(:last-child){border-bottom:1px solid ",(e=>e.theme.innerBorder),";}"),H=(0,s.Z)("div",{target:"e1pnio0z4"})({name:"1bxfgt5",styles:"display:flex;flex-direction:row;justify-content:flex-start;align-items:center;width:100%"}),R=(0,s.Z)("label",{target:"e1pnio0z3"})({name:"12ir9nx",styles:"display:grid;cursor:pointer;gap:0.25em 0.5em;grid-template-columns:max-content auto;align-items:center;outline:none;font-weight:normal;margin:0"}),V=(0,s.Z)(A.Z,{target:"e1pnio0z2"})({name:"ti75j2",styles:"margin:0"}),q=(0,s.Z)("div",{target:"e1pnio0z1"})({name:"1okymkx",styles:"max-height:250px;overflow-y:auto"}),D=(0,s.Z)("div",{target:"e1pnio0z0"})({name:"e0dnmk",styles:"cursor:pointer"}),P=L;function F(e){let{onClick:t}=e;return(0,B.BX)("div",{onClick:t,children:[(0,B.tZ)("span",{children:(0,f.t)("operation duration")}),(0,B.tZ)(X,{size:"xs",position:"top",title:(0,f.t)("Span durations are summed over the course of an entire transaction. Any overlapping spans are only counted once.")})]})}F.displayName="OperationTitle";class N extends o.Component{constructor(){super(...arguments),(0,i.Z)(this,"state",{widths:[],lastFetchedCursor:"",attachments:[],hasMinidumps:!1}),(0,i.Z)(this,"api",new d.KU),(0,i.Z)(this,"replayLinkGenerator",(0,E.MF)(this.props.routes)),(0,i.Z)(this,"handleCellAction",(e=>(t,n)=>{const{eventView:i,location:s,organization:o,excludedTags:a}=this.props;(0,b.ec)({eventKey:"performance_views.transactionEvents.cellaction",eventName:"Performance Views: Transaction Events Tab Cell Action Clicked",organization_id:parseInt(o.id,10),action:t});const l=(0,E.xf)(i.query);a&&a.forEach((e=>{l.removeFilter(e)})),(0,k.rh)(l,t,e,n),r.browserHistory.push({pathname:s.pathname,query:{...s.query,cursor:void 0,query:l.formatString()}})})),(0,i.Z)(this,"renderBodyCellWithData",(e=>(t,n)=>this.renderBodyCell(e,t,n))),(0,i.Z)(this,"renderHeadCellWithMeta",(e=>{const t=this.props.columnTitles??S.hj;return(n,i)=>this.renderHeadCell(e,n,t[i])})),(0,i.Z)(this,"handleResizeColumn",((e,t)=>{const n=[...this.state.widths];n[e]=t.width?Number(t.width):p.z7,this.setState({...this.state,widths:n})}))}renderBodyCell(e,t,n){const{eventView:i,organization:s,location:o,transactionName:r,projectSlug:a}=this.props;if(!e||!e.meta)return n[t.key];const l=e.meta,d=String(t.key),p=(0,Z.Js)(d,l)(n,{organization:s,location:o,eventView:i,projectSlug:a}),c=[k.eX.ADD,k.eX.EXCLUDE,k.eX.SHOW_GREATER_THAN,k.eX.SHOW_LESS_THAN];if(["attachments","minidump"].includes(d))return p;if("id"===d||"trace"===d){const{issueId:e}=this.props;let i={};return e&&"id"===d?i.pathname=`/organizations/${s.slug}/issues/${e}/events/${n.id}/`:i=("id"===d?E.vd:E.Z6)(r)(s,n,o.query),(0,B.tZ)(k.ZP,{column:t,dataRow:n,handleCellAction:this.handleCellAction(t),allowActions:c,children:(0,B.tZ)(m.Z,{to:i,children:p})})}if("replayId"===d){const e=n.replayId?this.replayLinkGenerator(s,n,void 0):null;return(0,B.tZ)(k.ZP,{column:t,dataRow:n,handleCellAction:this.handleCellAction(t),allowActions:c,children:e?(0,B.tZ)(m.Z,{to:e,children:p}):p})}const u=(0,w.LY)(d),h=n[u];return"integer"===l[u]&&(0,v.ri)(h)&&h>999?(0,B.tZ)(g.Z,{title:h.toLocaleString(),containerDisplayMode:"block",position:"right",children:(0,B.tZ)(k.ZP,{column:t,dataRow:n,handleCellAction:this.handleCellAction(t),allowActions:c,children:p})}):(0,B.tZ)(k.ZP,{column:t,dataRow:n,handleCellAction:this.handleCellAction(t),allowActions:c,children:p})}onSortClick(e,t){const{organization:n}=this.props;(0,b.ec)({eventKey:"performance_views.transactionEvents.sort",eventName:"Performance Views: Transaction Events Tab Sorted",organization_id:parseInt(n.id,10),field:t,direction:e})}renderHeadCell(e,t,n){const{eventView:i,location:s}=this.props,o=(0,w.qG)(t.name,t.type,e),r={field:t.name,width:t.width},a=i.sortForField(r,e),l="id"!==r.field&&"trace"!==r.field&&"replayId"!==r.field&&r.field!==w.zD&&(0,x.M3)(r,e),d=a?a.kind:void 0,p=a?a.field:void 0;return r.field===w.zD&&(n=(0,B.tZ)(P,{title:F,eventView:i,tableMeta:e,location:s})),(0,B.tZ)(c.Z,{align:o,title:n||r.field,direction:d,canSort:l,generateSortLink:function(){if(!e)return;const t=i.sortOnField(r,e).generateQueryStringObject();return{...s,query:{...s.query,sort:t.sort}}},onClick:()=>this.onSortClick(d,p)})}render(){const{eventView:e,organization:t,location:n,setError:i,totalEventCount:s,referrer:r,showReplayCol:a}=this.props,d=e.clone();d.sorts=[],d.fields=[{field:"count()",width:-1}];const{widths:c}=this.state,m=e.getColumns().find((e=>e.name===w.zD)),h=e.getColumns().filter((e=>(!m||!(0,w.yK)(e.name))&&"replayId"!==e.name||a)).map(((e,t)=>"number"==typeof c[t]?{...e,width:c[t]}:e));this.props.customColumns?.includes("attachments")&&this.state.attachments.length&&h.push({isSortable:!1,key:"attachments",name:"attachments",type:"never",column:{field:"attachments",kind:"field",alias:void 0}}),this.props.customColumns?.includes("minidump")&&this.state.hasMinidumps&&h.push({isSortable:!1,key:"minidump",name:"minidump",type:"never",column:{field:"minidump",kind:"field",alias:void 0}});const g=e=>{let{data:t}=e;const n=l()(this.state.attachments,"event_id");t.forEach((e=>{e.attachments=n[e.id]||[]}))},v=async(e,t)=>{let{data:n}=e;const i=n.map((e=>e.id)),s=["per_page=50",...this.props.customColumns?.includes("attachments")?[]:["types=event.minidump"],...i.map((e=>`event_id=${e}`))].join("&"),o=await this.api.requestPromise(`/api/0/issues/${this.props.issueId}/attachments/?${s}`);let r=!1;o.forEach((e=>{"event.minidump"===e.type&&(r=!0)})),this.setState({...this.state,lastFetchedCursor:t,attachments:o,hasMinidumps:r})};return(0,B.tZ)("div",{"data-test-id":"events-table",children:(0,B.tZ)(y.Z,{eventView:e,orgSlug:t.slug,location:n,setError:e=>i(e?.message),referrer:r||"api.performance.transaction-events",useEvents:!0,children:i=>{let{pageLinks:r,isLoading:a,tableData:l}=i;l??={data:[]};const d=(0,C.Z)(r),c=d?.next?.cursor,m=t.features.includes("event-attachments")&&!!this.props.issueId&&!!c&&this.state.lastFetchedCursor!==c;let b=c?.split(":")[1]??0;!d?.next?.results&&s&&(b=s);const y=s&&b?(0,f._N)("Showing [currentEvent] of [totalEventCount] events",{currentEvent:b,totalEventCount:s}):void 0;return m&&v(l,c),g(l),(0,B.BX)(o.Fragment,{children:[(0,B.tZ)(p.ZP,{isLoading:a||m,data:l?.data??[],columnOrder:h,columnSortBy:e.getSorts(),grid:{onResizeColumn:this.handleResizeColumn,renderHeadCell:this.renderHeadCellWithMeta(l?.meta),renderBodyCell:this.renderBodyCellWithData(l)},location:n}),(0,B.tZ)(u.Z,{disabled:a,caption:y,pageLinks:r})]})}})})}}N.displayName="EventsTable";const X=(0,s.Z)(h.Z,{target:"e8p3pb0"})({name:"1dgfen9",styles:"position:relative;top:1px;left:4px"}),W=N}}]);
//# sourceMappingURL=../sourcemaps/app_views_performance_transactionSummary_transactionEvents_eventsTable_tsx.3b52c8274619a97254cc813eaadca9a3.js.map