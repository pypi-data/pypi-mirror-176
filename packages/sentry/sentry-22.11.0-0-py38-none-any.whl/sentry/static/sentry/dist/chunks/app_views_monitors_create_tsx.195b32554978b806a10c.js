"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_monitors_create_tsx"],{"./app/views/asyncView.tsx":(e,t,n)=>{n.d(t,{Z:()=>r});var s=n("./app/components/asyncComponent.tsx"),i=n("./app/components/sentryDocumentTitle.tsx"),o=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class r extends s.Z{getTitle(){return""}render(){return(0,o.tZ)(i.Z,{title:this.getTitle(),children:this.renderComponent()})}}r.displayName="AsyncView"},"./app/views/monitors/create.tsx":(e,t,n)=>{n.r(t),n.d(t,{default:()=>p});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=n("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),o=n("../node_modules/react-router/es/index.js"),r=n("./app/components/layouts/thirds.tsx"),l=n("./app/locale.tsx"),a=n("./app/views/asyncView.tsx"),c=n("./app/views/monitors/monitorForm.tsx"),d=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class p extends a.Z{constructor(){super(...arguments),(0,s.Z)(this,"onSubmitSuccess",(e=>{o.browserHistory.push(`/organizations/${this.props.params.orgId}/monitors/${e.id}/`)}))}getTitle(){return`Monitors - ${this.props.params.orgId}`}renderBody(){return(0,d.tZ)(r.uT,{children:(0,d.BX)(r.or,{fullWidth:!0,children:[(0,d.tZ)("h1",{children:(0,l.t)("New Monitor")}),(0,d.tZ)(u,{children:(0,l.t)("Creating a monitor will allow you to track the executions of a scheduled\n             job in your organization. For example, ensure a cron job that is\n             scheduled to run once a day executes and finishes within a specified\n             duration.")}),(0,d.tZ)(c.Z,{apiMethod:"POST",apiEndpoint:`/organizations/${this.props.params.orgId}/monitors/`,onSubmitSuccess:this.onSubmitSuccess,submitLabel:(0,l.t)("Next Steps")})]})})}}const u=(0,i.Z)("p",{target:"e9na96i0"})("color:",(e=>e.theme.subText),";max-width:760px;")},"./app/views/monitors/monitorForm.tsx":(e,t,n)=>{n.d(t,{Z:()=>_});var s=n("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=n("../node_modules/react/index.js"),o=n("../node_modules/mobx-react-lite/es/index.js"),r=n("./app/components/acl/access.tsx"),l=n("./app/components/forms/field/index.tsx"),a=n("./app/components/forms/fields/numberField.tsx"),c=n("./app/components/forms/fields/selectField.tsx"),d=n("./app/components/forms/fields/textField.tsx"),p=n("./app/components/forms/form.tsx"),u=n("./app/components/forms/model.tsx"),m=n("./app/components/panels/index.tsx"),h=n("./app/components/textCopyInput.tsx"),b=n("./app/locale.tsx"),f=n("./app/utils/withPageFilters.tsx"),g=n("./app/utils/withProjects.tsx"),x=n("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const Z=[{value:"crontab",label:"Crontab"},{value:"interval",label:"Interval"}],y=[{value:"cron_job",label:"Cron Job"}],w=[{value:"minute",label:"minute(s)"},{value:"hour",label:"hour(s)"},{value:"day",label:"day(s)"},{value:"week",label:"week(s)"},{value:"month",label:"month(s)"},{value:"year",label:"year(s)"}];function j(e,t){return t.fields.toJSON().reduce(((e,t)=>{let[n,s]=t;return 0!==n.indexOf("config.")?(e[n]=s,e):(e.config||(e.config={}),"config.schedule.frequency"!==n&&"config.schedule.interval"!==n||Array.isArray(e.config.schedule)||(e.config.schedule=[null,null]),"config.schedule.frequency"===n?e.config.schedule[0]=parseInt(s,10):"config.schedule.interval"===n?e.config.schedule[1]=s:e.config[n.substr(7)]=s,e)}),{})}class v extends i.Component{constructor(){super(...arguments),(0,s.Z)(this,"form",new u.Z({transformData:j}))}formDataFromConfig(e,t){const n={};return"cron_job"===e&&(n["config.schedule_type"]=t.schedule_type,n["config.checkin_margin"]=t.checkin_margin,n["config.max_runtime"]=t.max_runtime,"interval"===t.schedule_type?(n["config.schedule.frequency"]=t.schedule[0],n["config.schedule.interval"]=t.schedule[1]):n["config.schedule"]=t.schedule),n}render(){const{monitor:e,submitLabel:t}=this.props,n=this.props.selection.projects[0],s=n?this.props.projects.find((e=>e.id===n+"")):null;return(0,x.tZ)(r.Z,{access:["project:write"],children:n=>{let{hasAccess:r}=n;return(0,x.BX)(p.Z,{allowUndo:!0,requireChanges:!0,apiEndpoint:this.props.apiEndpoint,apiMethod:this.props.apiMethod,model:this.form,initialData:e?{name:e.name,type:e.type,project:e.project.slug,...this.formDataFromConfig(e.type,e.config)}:{project:s?s.slug:null},onSubmitSuccess:this.props.onSubmitSuccess,submitLabel:t,children:[(0,x.BX)(m.s_,{children:[(0,x.tZ)(m.V9,{children:(0,b.t)("Details")}),(0,x.BX)(m.N,{children:[e&&(0,x.tZ)(l.Z,{label:(0,b.t)("ID"),children:(0,x.tZ)("div",{className:"controls",children:(0,x.tZ)(h.ZP,{children:e.id})})}),(0,x.tZ)(c.Z,{name:"project",label:(0,b.t)("Project"),disabled:!r,options:this.props.projects.filter((e=>e.isMember)).map((e=>({value:e.slug,label:e.slug}))),help:(0,b.t)("Associate your monitor with the appropriate project."),required:!0}),(0,x.tZ)(d.Z,{name:"name",placeholder:(0,b.t)("My Cron Job"),label:(0,b.t)("Name"),disabled:!r,required:!0})]})]}),(0,x.BX)(m.s_,{children:[(0,x.tZ)(m.V9,{children:(0,b.t)("Config")}),(0,x.BX)(m.N,{children:[(0,x.tZ)(c.Z,{name:"type",label:(0,b.t)("Type"),disabled:!r,options:y,required:!0}),(0,x.tZ)(o.Qj,{children:()=>"cron_job"===this.form.getValue("type")?(0,x.BX)(i.Fragment,{children:[(0,x.tZ)(a.Z,{name:"config.max_runtime",label:(0,b.t)("Max Runtime"),disabled:!r,help:(0,b.t)("The maximum runtime (in minutes) a check-in is allowed before it's marked as a failure."),placeholder:"e.g. 30"}),(0,x.tZ)(c.Z,{name:"config.schedule_type",label:(0,b.t)("Schedule Type"),disabled:!r,options:Z,required:!0})]}):null}),(0,x.tZ)(o.Qj,{children:()=>{switch(this.form.getValue("config.schedule_type")){case"crontab":return(0,x.BX)(i.Fragment,{children:[(0,x.tZ)(d.Z,{name:"config.schedule",label:(0,b.t)("Schedule"),disabled:!r,placeholder:"*/5 * * * *",required:!0,help:(0,b._N)("Changes to the schedule will apply on the next check-in. See [link:Wikipedia] for crontab syntax.",{link:(0,x.tZ)("a",{href:"https://en.wikipedia.org/wiki/Cron"})})}),(0,x.tZ)(a.Z,{name:"config.checkin_margin",label:(0,b.t)("Check-in Margin"),disabled:!r,help:(0,b.t)("The margin (in minutes) a check-in is allowed to exceed it's scheduled window before being treated as missed."),placeholder:"e.g. 30"})]});case"interval":return(0,x.BX)(i.Fragment,{children:[(0,x.tZ)(a.Z,{name:"config.schedule.frequency",label:(0,b.t)("Frequency"),disabled:!r,placeholder:"e.g. 1",help:(0,b.t)("The amount of times you expect the cron job to run within the specified interval."),required:!0}),(0,x.tZ)(c.Z,{name:"config.schedule.interval",label:(0,b.t)("Interval"),disabled:!r,options:w,help:(0,b.t)("The interval on which the frequency will be applied. X times an (hour, day, week...)"),required:!0}),(0,x.tZ)(a.Z,{name:"config.checkin_margin",label:(0,b.t)("Check-in Margin"),disabled:!r,help:(0,b.t)("The margin (in minutes) a check-in is allowed to exceed it's scheduled window before being treated as missed."),placeholder:"e.g. 30"})]});default:return null}}})]})]})]})}})}}v.displayName="MonitorForm";const _=(0,f.Z)((0,g.Z)(v))}}]);
//# sourceMappingURL=../sourcemaps/app_views_monitors_create_tsx.51f6fde4cfb097f7565d3148ffec7d2b.js.map