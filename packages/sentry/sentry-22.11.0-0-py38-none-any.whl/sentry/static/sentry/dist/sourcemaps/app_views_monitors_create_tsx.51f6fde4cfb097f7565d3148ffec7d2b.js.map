{"version":3,"file":"chunks/app_views_monitors_create_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/views/asyncView.tsx","webpack:///./app/views/monitors/create.tsx","webpack:///./app/views/monitors/monitorForm.tsx"],"sourcesContent":["import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import {browserHistory, RouteComponentProps} from 'react-router';\nimport styled from '@emotion/styled';\n\nimport * as Layout from 'sentry/components/layouts/thirds';\nimport {t} from 'sentry/locale';\nimport AsyncView from 'sentry/views/asyncView';\n\nimport MonitorForm from './monitorForm';\nimport {Monitor} from './types';\n\ntype Props = AsyncView['props'] & RouteComponentProps<{orgId: string}, {}>;\n\nexport default class CreateMonitor extends AsyncView<Props, AsyncView['state']> {\n  getTitle() {\n    return `Monitors - ${this.props.params.orgId}`;\n  }\n\n  onSubmitSuccess = (data: Monitor) => {\n    browserHistory.push(`/organizations/${this.props.params.orgId}/monitors/${data.id}/`);\n  };\n\n  renderBody() {\n    return (\n      <Layout.Body>\n        <Layout.Main fullWidth>\n          <h1>{t('New Monitor')}</h1>\n          <HelpText>\n            {t(\n              `Creating a monitor will allow you to track the executions of a scheduled\n             job in your organization. For example, ensure a cron job that is\n             scheduled to run once a day executes and finishes within a specified\n             duration.`\n            )}\n          </HelpText>\n          <MonitorForm\n            apiMethod=\"POST\"\n            apiEndpoint={`/organizations/${this.props.params.orgId}/monitors/`}\n            onSubmitSuccess={this.onSubmitSuccess}\n            submitLabel={t('Next Steps')}\n          />\n        </Layout.Main>\n      </Layout.Body>\n    );\n  }\n}\n\nconst HelpText = styled('p')`\n  color: ${p => p.theme.subText};\n  max-width: 760px;\n`;\n","import {Component, Fragment} from 'react';\nimport {Observer} from 'mobx-react';\n\nimport Access from 'sentry/components/acl/access';\nimport Field from 'sentry/components/forms/field';\nimport NumberField from 'sentry/components/forms/fields/numberField';\nimport SelectField from 'sentry/components/forms/fields/selectField';\nimport TextField from 'sentry/components/forms/fields/textField';\nimport Form, {FormProps} from 'sentry/components/forms/form';\nimport FormModel from 'sentry/components/forms/model';\nimport {Panel, PanelBody, PanelHeader} from 'sentry/components/panels';\nimport TextCopyInput from 'sentry/components/textCopyInput';\nimport {t, tct} from 'sentry/locale';\nimport {PageFilters, Project, SelectValue} from 'sentry/types';\nimport withPageFilters from 'sentry/utils/withPageFilters';\nimport withProjects from 'sentry/utils/withProjects';\n\nimport {Monitor, MonitorConfig, MonitorTypes, ScheduleType} from './types';\n\nconst SCHEDULE_TYPES: SelectValue<ScheduleType>[] = [\n  {value: 'crontab', label: 'Crontab'},\n  {value: 'interval', label: 'Interval'},\n];\n\nconst MONITOR_TYPES: SelectValue<MonitorTypes>[] = [\n  {value: 'cron_job', label: 'Cron Job'},\n];\n\nconst INTERVALS: SelectValue<string>[] = [\n  {value: 'minute', label: 'minute(s)'},\n  {value: 'hour', label: 'hour(s)'},\n  {value: 'day', label: 'day(s)'},\n  {value: 'week', label: 'week(s)'},\n  {value: 'month', label: 'month(s)'},\n  {value: 'year', label: 'year(s)'},\n];\n\ntype Props = {\n  apiEndpoint: string;\n  apiMethod: FormProps['apiMethod'];\n  onSubmitSuccess: FormProps['onSubmitSuccess'];\n  projects: Project[];\n  selection: PageFilters;\n  monitor?: Monitor;\n  submitLabel?: string;\n};\n\ntype TransformedData = {\n  config?: Partial<MonitorConfig>;\n};\n\nfunction transformData(_data: Record<string, any>, model: FormModel) {\n  return model.fields.toJSON().reduce<TransformedData>((data, [k, v]) => {\n    if (k.indexOf('config.') !== 0) {\n      data[k] = v;\n      return data;\n    }\n\n    if (!data.config) {\n      data.config = {};\n    }\n    if (k === 'config.schedule.frequency' || k === 'config.schedule.interval') {\n      if (!Array.isArray(data.config.schedule)) {\n        data.config.schedule = [null, null];\n      }\n    }\n\n    if (k === 'config.schedule.frequency') {\n      data.config!.schedule![0] = parseInt(v as string, 10);\n    } else if (k === 'config.schedule.interval') {\n      data.config!.schedule![1] = v;\n    } else {\n      data.config[k.substr(7)] = v;\n    }\n\n    return data;\n  }, {});\n}\n\nclass MonitorForm extends Component<Props> {\n  form = new FormModel({transformData});\n\n  formDataFromConfig(type: MonitorTypes, config: MonitorConfig) {\n    const rv = {};\n    switch (type) {\n      case 'cron_job':\n        rv['config.schedule_type'] = config.schedule_type;\n        rv['config.checkin_margin'] = config.checkin_margin;\n        rv['config.max_runtime'] = config.max_runtime;\n\n        switch (config.schedule_type) {\n          case 'interval':\n            rv['config.schedule.frequency'] = config.schedule[0];\n            rv['config.schedule.interval'] = config.schedule[1];\n            break;\n          case 'crontab':\n          default:\n            rv['config.schedule'] = config.schedule;\n        }\n        break;\n      default:\n    }\n    return rv;\n  }\n\n  render() {\n    const {monitor, submitLabel} = this.props;\n    const selectedProjectId = this.props.selection.projects[0];\n    const selectedProject = selectedProjectId\n      ? this.props.projects.find(p => p.id === selectedProjectId + '')\n      : null;\n    return (\n      <Access access={['project:write']}>\n        {({hasAccess}) => (\n          <Form\n            allowUndo\n            requireChanges\n            apiEndpoint={this.props.apiEndpoint}\n            apiMethod={this.props.apiMethod}\n            model={this.form}\n            initialData={\n              monitor\n                ? {\n                    name: monitor.name,\n                    type: monitor.type,\n                    project: monitor.project.slug,\n                    ...this.formDataFromConfig(monitor.type, monitor.config),\n                  }\n                : {\n                    project: selectedProject ? selectedProject.slug : null,\n                  }\n            }\n            onSubmitSuccess={this.props.onSubmitSuccess}\n            submitLabel={submitLabel}\n          >\n            <Panel>\n              <PanelHeader>{t('Details')}</PanelHeader>\n\n              <PanelBody>\n                {monitor && (\n                  <Field label={t('ID')}>\n                    <div className=\"controls\">\n                      <TextCopyInput>{monitor.id}</TextCopyInput>\n                    </div>\n                  </Field>\n                )}\n                <SelectField\n                  name=\"project\"\n                  label={t('Project')}\n                  disabled={!hasAccess}\n                  options={this.props.projects\n                    .filter(p => p.isMember)\n                    .map(p => ({value: p.slug, label: p.slug}))}\n                  help={t('Associate your monitor with the appropriate project.')}\n                  required\n                />\n                <TextField\n                  name=\"name\"\n                  placeholder={t('My Cron Job')}\n                  label={t('Name')}\n                  disabled={!hasAccess}\n                  required\n                />\n              </PanelBody>\n            </Panel>\n            <Panel>\n              <PanelHeader>{t('Config')}</PanelHeader>\n\n              <PanelBody>\n                <SelectField\n                  name=\"type\"\n                  label={t('Type')}\n                  disabled={!hasAccess}\n                  options={MONITOR_TYPES}\n                  required\n                />\n                <Observer>\n                  {() => {\n                    switch (this.form.getValue('type')) {\n                      case 'cron_job':\n                        return (\n                          <Fragment>\n                            <NumberField\n                              name=\"config.max_runtime\"\n                              label={t('Max Runtime')}\n                              disabled={!hasAccess}\n                              help={t(\n                                \"The maximum runtime (in minutes) a check-in is allowed before it's marked as a failure.\"\n                              )}\n                              placeholder=\"e.g. 30\"\n                            />\n                            <SelectField\n                              name=\"config.schedule_type\"\n                              label={t('Schedule Type')}\n                              disabled={!hasAccess}\n                              options={SCHEDULE_TYPES}\n                              required\n                            />\n                          </Fragment>\n                        );\n                      default:\n                        return null;\n                    }\n                  }}\n                </Observer>\n                <Observer>\n                  {() => {\n                    switch (this.form.getValue('config.schedule_type')) {\n                      case 'crontab':\n                        return (\n                          <Fragment>\n                            <TextField\n                              name=\"config.schedule\"\n                              label={t('Schedule')}\n                              disabled={!hasAccess}\n                              placeholder=\"*/5 * * * *\"\n                              required\n                              help={tct(\n                                'Changes to the schedule will apply on the next check-in. See [link:Wikipedia] for crontab syntax.',\n                                {\n                                  link: <a href=\"https://en.wikipedia.org/wiki/Cron\" />,\n                                }\n                              )}\n                            />\n                            <NumberField\n                              name=\"config.checkin_margin\"\n                              label={t('Check-in Margin')}\n                              disabled={!hasAccess}\n                              help={t(\n                                \"The margin (in minutes) a check-in is allowed to exceed it's scheduled window before being treated as missed.\"\n                              )}\n                              placeholder=\"e.g. 30\"\n                            />\n                          </Fragment>\n                        );\n                      case 'interval':\n                        return (\n                          <Fragment>\n                            <NumberField\n                              name=\"config.schedule.frequency\"\n                              label={t('Frequency')}\n                              disabled={!hasAccess}\n                              placeholder=\"e.g. 1\"\n                              help={t(\n                                'The amount of times you expect the cron job to run within the specified interval.'\n                              )}\n                              required\n                            />\n                            <SelectField\n                              name=\"config.schedule.interval\"\n                              label={t('Interval')}\n                              disabled={!hasAccess}\n                              options={INTERVALS}\n                              help={t(\n                                'The interval on which the frequency will be applied. X times an (hour, day, week...)'\n                              )}\n                              required\n                            />\n                            <NumberField\n                              name=\"config.checkin_margin\"\n                              label={t('Check-in Margin')}\n                              disabled={!hasAccess}\n                              help={t(\n                                \"The margin (in minutes) a check-in is allowed to exceed it's scheduled window before being treated as missed.\"\n                              )}\n                              placeholder=\"e.g. 30\"\n                            />\n                          </Fragment>\n                        );\n                      default:\n                        return null;\n                    }\n                  }}\n                </Observer>\n              </PanelBody>\n            </Panel>\n          </Form>\n        )}\n      </Access>\n    );\n  }\n}\n\nexport default withPageFilters(withProjects(MonitorForm));\n"],"names":["AsyncView","AsyncComponent","getTitle","render","title","this","renderComponent","CreateMonitor","data","browserHistory","props","params","orgId","id","renderBody","fullWidth","t","HelpText","apiMethod","apiEndpoint","onSubmitSuccess","submitLabel","p","theme","subText","SCHEDULE_TYPES","value","label","MONITOR_TYPES","INTERVALS","transformData","_data","model","fields","toJSON","reduce","k","v","indexOf","config","Array","isArray","schedule","parseInt","substr","MonitorForm","Component","FormModel","formDataFromConfig","type","rv","schedule_type","checkin_margin","max_runtime","monitor","selectedProjectId","selection","projects","selectedProject","find","access","hasAccess","allowUndo","requireChanges","form","initialData","name","project","slug","className","disabled","options","filter","isMember","map","help","required","placeholder","getValue","Fragment","tct","link","href","withPageFilters","withProjects"],"sourceRoot":""}