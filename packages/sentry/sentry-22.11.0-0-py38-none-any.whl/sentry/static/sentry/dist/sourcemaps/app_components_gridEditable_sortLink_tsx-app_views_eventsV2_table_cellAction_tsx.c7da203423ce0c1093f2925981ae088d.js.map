{"version":3,"file":"chunks/app_components_gridEditable_sortLink_tsx-app_views_eventsV2_table_cellAction_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/components/gridEditable/sortLink.tsx","webpack:///./app/views/eventsV2/table/cellAction.tsx"],"sourcesContent":["import {browserHistory} from 'react-router';\nimport styled from '@emotion/styled';\nimport {LocationDescriptorObject} from 'history';\nimport omit from 'lodash/omit';\n\nimport Link from 'sentry/components/links/link';\nimport {IconArrow} from 'sentry/icons';\n\nexport type Alignments = 'left' | 'right' | undefined;\nexport type Directions = 'desc' | 'asc' | undefined;\n\ntype Props = {\n  align: Alignments;\n  canSort: boolean;\n  direction: Directions;\n  generateSortLink: () => LocationDescriptorObject | undefined;\n  title: React.ReactNode;\n  onClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\n  replace?: boolean;\n};\n\nfunction SortLink({\n  align,\n  title,\n  canSort,\n  generateSortLink,\n  onClick,\n  direction,\n  replace,\n}: Props) {\n  const target = generateSortLink();\n\n  if (!target || !canSort) {\n    return <StyledNonLink align={align}>{title}</StyledNonLink>;\n  }\n\n  const arrow = !direction ? null : (\n    <StyledIconArrow size=\"xs\" direction={direction === 'desc' ? 'down' : 'up'} />\n  );\n\n  const handleOnClick: React.MouseEventHandler<HTMLAnchorElement> = e => {\n    if (replace) {\n      e.preventDefault();\n      browserHistory.replace(target);\n    }\n    onClick?.(e);\n  };\n\n  return (\n    <StyledLink align={align} to={target} onClick={handleOnClick}>\n      {title} {arrow}\n    </StyledLink>\n  );\n}\n\ntype LinkProps = React.ComponentPropsWithoutRef<typeof Link>;\ntype StyledLinkProps = LinkProps & {align: Alignments};\n\nconst StyledLink = styled((props: StyledLinkProps) => {\n  const forwardProps = omit(props, ['align', 'css']);\n  return <Link {...forwardProps} />;\n})`\n  display: block;\n  width: 100%;\n  white-space: nowrap;\n  color: inherit;\n\n  &:hover,\n  &:active,\n  &:focus,\n  &:visited {\n    color: inherit;\n  }\n\n  ${(p: StyledLinkProps) => (p.align ? `text-align: ${p.align};` : '')}\n`;\n\nconst StyledNonLink = styled('div')<{align: Alignments}>`\n  display: block;\n  width: 100%;\n  white-space: nowrap;\n  ${(p: {align: Alignments}) => (p.align ? `text-align: ${p.align};` : '')}\n`;\n\nconst StyledIconArrow = styled(IconArrow)`\n  vertical-align: top;\n`;\n\nexport default SortLink;\n","import {Component} from 'react';\nimport {createPortal} from 'react-dom';\nimport {Manager, Popper, Reference} from 'react-popper';\nimport styled from '@emotion/styled';\nimport color from 'color';\n\nimport {IconEllipsis} from 'sentry/icons';\nimport {t, tct} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport {defined} from 'sentry/utils';\nimport {TableDataRow} from 'sentry/utils/discover/discoverQuery';\nimport {\n  isEquationAlias,\n  isRelativeSpanOperationBreakdownField,\n} from 'sentry/utils/discover/fields';\nimport {getDuration} from 'sentry/utils/formatters';\nimport {MutableSearch} from 'sentry/utils/tokenizeSearch';\n\nimport {TableColumn} from './types';\n\nexport enum Actions {\n  ADD = 'add',\n  EXCLUDE = 'exclude',\n  SHOW_GREATER_THAN = 'show_greater_than',\n  SHOW_LESS_THAN = 'show_less_than',\n  TRANSACTION = 'transaction',\n  RELEASE = 'release',\n  DRILLDOWN = 'drilldown',\n  EDIT_THRESHOLD = 'edit_threshold',\n}\n\nexport function updateQuery(\n  results: MutableSearch,\n  action: Actions,\n  column: TableColumn<keyof TableDataRow>,\n  value: React.ReactText | string[]\n) {\n  const key = column.name;\n\n  if (column.type === 'duration' && typeof value === 'number') {\n    // values are assumed to be in milliseconds\n    value = getDuration(value / 1000, 2, true);\n  }\n\n  // De-duplicate array values\n  if (Array.isArray(value)) {\n    value = [...new Set(value)];\n    if (value.length === 1) {\n      value = value[0];\n    }\n  }\n\n  switch (action) {\n    case Actions.ADD:\n      // If the value is null/undefined create a has !has condition.\n      if (value === null || value === undefined) {\n        // Adding a null value is the same as excluding truthy values.\n        // Remove inclusion if it exists.\n        results.removeFilterValue('has', key);\n        results.addFilterValues('!has', [key]);\n      } else {\n        // Remove exclusion if it exists.\n        results.removeFilter(`!${key}`);\n\n        if (Array.isArray(value)) {\n          // For array values, add to existing filters\n          const currentFilters = results.getFilterValues(key);\n          value = [...new Set([...currentFilters, ...value])];\n        } else {\n          value = [String(value)];\n        }\n\n        results.setFilterValues(key, value);\n      }\n      break;\n    case Actions.EXCLUDE:\n      if (value === null || value === undefined) {\n        // Excluding a null value is the same as including truthy values.\n        // Remove exclusion if it exists.\n        results.removeFilterValue('!has', key);\n        results.addFilterValues('has', [key]);\n      } else {\n        // Remove positive if it exists.\n        results.removeFilter(key);\n        // Negations should stack up.\n        const negation = `!${key}`;\n        value = Array.isArray(value) ? value : [String(value)];\n        const currentNegations = results.getFilterValues(negation);\n        results.removeFilter(negation);\n        // We shouldn't escape any of the existing conditions since the\n        // existing conditions have already been set an verified by the user\n        results.addFilterValues(\n          negation,\n          currentNegations.filter(\n            filterValue => !(value as string[]).includes(filterValue)\n          ),\n          false\n        );\n        // Escapes the new condition if necessary\n        results.addFilterValues(negation, value);\n      }\n      break;\n    case Actions.SHOW_GREATER_THAN: {\n      // Remove query token if it already exists\n      results.setFilterValues(key, [`>${value}`]);\n      break;\n    }\n    case Actions.SHOW_LESS_THAN: {\n      // Remove query token if it already exists\n      results.setFilterValues(key, [`<${value}`]);\n      break;\n    }\n    // these actions do not modify the query in any way,\n    // instead they have side effects\n    case Actions.TRANSACTION:\n    case Actions.RELEASE:\n    case Actions.DRILLDOWN:\n      break;\n    default:\n      throw new Error(`Unknown action type. ${action}`);\n  }\n}\n\ntype CellActionsOpts = {\n  column: TableColumn<keyof TableDataRow>;\n  dataRow: TableDataRow;\n  handleCellAction: (action: Actions, value: React.ReactText) => void;\n  /**\n   * allow list of actions to display on the context menu\n   */\n  allowActions?: Actions[];\n};\n\nfunction makeCellActions({\n  dataRow,\n  column,\n  handleCellAction,\n  allowActions,\n}: CellActionsOpts) {\n  // Do not render context menu buttons for the span op breakdown field.\n  if (isRelativeSpanOperationBreakdownField(column.name)) {\n    return null;\n  }\n\n  // Do not render context menu buttons for the equation fields until we can query on them\n  if (isEquationAlias(column.name)) {\n    return null;\n  }\n\n  let value = dataRow[column.name];\n\n  // error.handled is a strange field where null = true.\n  if (\n    Array.isArray(value) &&\n    value[0] === null &&\n    column.column.kind === 'field' &&\n    column.column.field === 'error.handled'\n  ) {\n    value = 1;\n  }\n  const actions: React.ReactNode[] = [];\n\n  function addMenuItem(action: Actions, menuItem: React.ReactNode) {\n    if ((Array.isArray(allowActions) && allowActions.includes(action)) || !allowActions) {\n      actions.push(menuItem);\n    }\n  }\n\n  if (\n    !['duration', 'number', 'percentage'].includes(column.type) ||\n    (value === null && column.column.kind === 'field')\n  ) {\n    addMenuItem(\n      Actions.ADD,\n      <ActionItem\n        key=\"add-to-filter\"\n        data-test-id=\"add-to-filter\"\n        onClick={() => handleCellAction(Actions.ADD, value)}\n      >\n        {t('Add to filter')}\n      </ActionItem>\n    );\n\n    if (column.type !== 'date') {\n      addMenuItem(\n        Actions.EXCLUDE,\n        <ActionItem\n          key=\"exclude-from-filter\"\n          data-test-id=\"exclude-from-filter\"\n          onClick={() => handleCellAction(Actions.EXCLUDE, value)}\n        >\n          {t('Exclude from filter')}\n        </ActionItem>\n      );\n    }\n  }\n\n  if (\n    ['date', 'duration', 'integer', 'number', 'percentage'].includes(column.type) &&\n    value !== null\n  ) {\n    addMenuItem(\n      Actions.SHOW_GREATER_THAN,\n      <ActionItem\n        key=\"show-values-greater-than\"\n        data-test-id=\"show-values-greater-than\"\n        onClick={() => handleCellAction(Actions.SHOW_GREATER_THAN, value)}\n      >\n        {t('Show values greater than')}\n      </ActionItem>\n    );\n\n    addMenuItem(\n      Actions.SHOW_LESS_THAN,\n      <ActionItem\n        key=\"show-values-less-than\"\n        data-test-id=\"show-values-less-than\"\n        onClick={() => handleCellAction(Actions.SHOW_LESS_THAN, value)}\n      >\n        {t('Show values less than')}\n      </ActionItem>\n    );\n  }\n\n  if (column.column.kind === 'field' && column.column.field === 'transaction') {\n    addMenuItem(\n      Actions.TRANSACTION,\n      <ActionItem\n        key=\"transaction-summary\"\n        data-test-id=\"transaction-summary\"\n        onClick={() => handleCellAction(Actions.TRANSACTION, value)}\n      >\n        {t('Go to summary')}\n      </ActionItem>\n    );\n  }\n\n  if (column.column.kind === 'field' && column.column.field === 'release' && value) {\n    addMenuItem(\n      Actions.RELEASE,\n      <ActionItem\n        key=\"release\"\n        data-test-id=\"release\"\n        onClick={() => handleCellAction(Actions.RELEASE, value)}\n      >\n        {t('Go to release')}\n      </ActionItem>\n    );\n  }\n\n  if (column.column.kind === 'function' && column.column.function[0] === 'count_unique') {\n    addMenuItem(\n      Actions.DRILLDOWN,\n      <ActionItem\n        key=\"drilldown\"\n        data-test-id=\"per-cell-drilldown\"\n        onClick={() => handleCellAction(Actions.DRILLDOWN, value)}\n      >\n        {t('View Stacks')}\n      </ActionItem>\n    );\n  }\n\n  if (\n    column.column.kind === 'function' &&\n    column.column.function[0] === 'user_misery' &&\n    defined(dataRow.project_threshold_config)\n  ) {\n    addMenuItem(\n      Actions.EDIT_THRESHOLD,\n      <ActionItem\n        key=\"edit_threshold\"\n        data-test-id=\"edit-threshold\"\n        onClick={() => handleCellAction(Actions.EDIT_THRESHOLD, value)}\n      >\n        {tct('Edit threshold ([threshold]ms)', {\n          threshold: dataRow.project_threshold_config[1],\n        })}\n      </ActionItem>\n    );\n  }\n\n  if (actions.length === 0) {\n    return null;\n  }\n\n  return actions;\n}\n\ntype Props = React.PropsWithoutRef<CellActionsOpts>;\n\ntype State = {\n  isHovering: boolean;\n  isOpen: boolean;\n};\n\nclass CellAction extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    let portal = document.getElementById('cell-action-portal');\n    if (!portal) {\n      portal = document.createElement('div');\n      portal.setAttribute('id', 'cell-action-portal');\n      document.body.appendChild(portal);\n    }\n    this.portalEl = portal;\n    this.menuEl = null;\n  }\n\n  state: State = {\n    isHovering: false,\n    isOpen: false,\n  };\n\n  componentDidUpdate(_props: Props, prevState: State) {\n    if (this.state.isOpen && prevState.isOpen === false) {\n      document.addEventListener('click', this.handleClickOutside, true);\n    }\n    if (this.state.isOpen === false && prevState.isOpen) {\n      document.removeEventListener('click', this.handleClickOutside, true);\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('click', this.handleClickOutside, true);\n  }\n\n  private portalEl: Element;\n  private menuEl: Element | null;\n\n  handleClickOutside = (event: MouseEvent) => {\n    if (!this.menuEl) {\n      return;\n    }\n    if (!(event.target instanceof Element)) {\n      return;\n    }\n    if (this.menuEl.contains(event.target)) {\n      return;\n    }\n    this.setState({isOpen: false, isHovering: false});\n  };\n\n  handleMouseEnter = () => {\n    this.setState({isHovering: true});\n  };\n\n  handleMouseLeave = () => {\n    this.setState(state => {\n      // Don't hide the button if the menu is open.\n      if (state.isOpen) {\n        return state;\n      }\n      return {...state, isHovering: false};\n    });\n  };\n\n  handleMenuToggle = (event: React.MouseEvent<HTMLButtonElement>) => {\n    event.preventDefault();\n    this.setState({isOpen: !this.state.isOpen});\n  };\n\n  renderMenu() {\n    const {isOpen} = this.state;\n\n    const actions = makeCellActions(this.props);\n\n    if (actions === null) {\n      // do not render the menu if there are no per cell actions\n      return null;\n    }\n\n    const modifiers = [\n      {\n        name: 'hide',\n        enabled: false,\n      },\n      {\n        name: 'preventOverflow',\n        enabled: true,\n        options: {\n          padding: 10,\n          altAxis: true,\n        },\n      },\n      {\n        name: 'offset',\n        options: {\n          offset: [0, ARROW_SIZE / 2],\n        },\n      },\n      {\n        name: 'computeStyles',\n        options: {\n          // Using the `transform` attribute causes our borders to get blurry\n          // in chrome. See [0]. This just causes it to use `top` / `left`\n          // positions, which should be fine.\n          //\n          // [0]: https://stackoverflow.com/questions/29543142/css3-transformation-blurry-borders\n          gpuAcceleration: false,\n        },\n      },\n    ];\n\n    const menu = !isOpen\n      ? null\n      : createPortal(\n          <Popper placement=\"top\" modifiers={modifiers}>\n            {({ref: popperRef, style, placement, arrowProps}) => (\n              <Menu\n                ref={ref => {\n                  (popperRef as Function)(ref);\n                  this.menuEl = ref;\n                }}\n                style={style}\n              >\n                <MenuArrow\n                  ref={arrowProps.ref}\n                  data-placement={placement}\n                  style={arrowProps.style}\n                />\n                <MenuButtons onClick={event => event.stopPropagation()}>\n                  {actions}\n                </MenuButtons>\n              </Menu>\n            )}\n          </Popper>,\n          this.portalEl\n        );\n\n    return (\n      <MenuRoot>\n        <Manager>\n          <Reference>\n            {({ref}) => (\n              <MenuButton ref={ref} onClick={this.handleMenuToggle}>\n                <IconEllipsis size=\"sm\" data-test-id=\"cell-action\" color=\"blue300\" />\n              </MenuButton>\n            )}\n          </Reference>\n          {menu}\n        </Manager>\n      </MenuRoot>\n    );\n  }\n\n  render() {\n    const {children} = this.props;\n    const {isHovering} = this.state;\n\n    return (\n      <Container\n        onMouseEnter={this.handleMouseEnter}\n        onMouseLeave={this.handleMouseLeave}\n      >\n        {children}\n        {isHovering && this.renderMenu()}\n      </Container>\n    );\n  }\n}\n\nexport default CellAction;\n\nconst Container = styled('div')`\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n`;\n\nconst MenuRoot = styled('div')`\n  position: absolute;\n  top: 0;\n  right: 0;\n`;\n\nconst Menu = styled('div')`\n  z-index: ${p => p.theme.zIndex.tooltip};\n`;\n\nconst MenuButtons = styled('div')`\n  background: ${p => p.theme.background};\n  border: 1px solid ${p => p.theme.border};\n  border-radius: ${p => p.theme.borderRadius};\n  box-shadow: ${p => p.theme.dropShadowHeavy};\n  overflow: hidden;\n`;\n\nconst ARROW_SIZE = 12;\n\nconst MenuArrow = styled('span')`\n  pointer-events: none;\n  position: absolute;\n  width: ${ARROW_SIZE}px;\n  height: ${ARROW_SIZE}px;\n\n  &::before,\n  &::after {\n    content: '';\n    display: block;\n    position: absolute;\n    height: ${ARROW_SIZE}px;\n    width: ${ARROW_SIZE}px;\n    border: solid 6px transparent;\n  }\n\n  &[data-placement|='bottom'] {\n    top: -${ARROW_SIZE}px;\n    &::before {\n      bottom: 1px;\n      border-bottom-color: ${p => p.theme.translucentBorder};\n    }\n    &::after {\n      border-bottom-color: ${p => p.theme.backgroundElevated};\n    }\n  }\n\n  &[data-placement|='top'] {\n    bottom: -${ARROW_SIZE}px;\n    &::before {\n      top: 1px;\n      border-top-color: ${p => p.theme.translucentBorder};\n    }\n    &::after {\n      border-top-color: ${p => p.theme.backgroundElevated};\n    }\n  }\n\n  &[data-placement|='right'] {\n    left: -${ARROW_SIZE}px;\n    &::before {\n      right: 1px;\n      border-right-color: ${p => p.theme.translucentBorder};\n    }\n    &::after {\n      border-right-color: ${p => p.theme.backgroundElevated};\n    }\n  }\n\n  &[data-placement|='left'] {\n    right: -${ARROW_SIZE}px;\n    &::before {\n      left: 1px;\n      border-left-color: ${p => p.theme.translucentBorder};\n    }\n    &::after {\n      border-left-color: ${p => p.theme.backgroundElevated};\n    }\n  }\n`;\n\nconst ActionItem = styled('button')`\n  display: block;\n  width: 100%;\n  padding: ${space(1)} ${space(2)};\n  background: transparent;\n\n  outline: none;\n  border: 0;\n  border-bottom: 1px solid ${p => p.theme.innerBorder};\n\n  font-size: ${p => p.theme.fontSizeMedium};\n  text-align: left;\n  line-height: 1.2;\n\n  &:hover {\n    background: ${p => p.theme.backgroundSecondary};\n  }\n\n  &:last-child {\n    border-bottom: 0;\n  }\n`;\n\nconst MenuButton = styled('button')`\n  display: flex;\n  width: 24px;\n  height: 24px;\n  padding: 0;\n  justify-content: center;\n  align-items: center;\n\n  background: ${p => color(p.theme.background).alpha(0.85).string()};\n  border-radius: ${p => p.theme.borderRadius};\n  border: 1px solid ${p => p.theme.border};\n  cursor: pointer;\n  outline: none;\n`;\n"],"names":["SortLink","align","title","canSort","generateSortLink","onClick","direction","replace","target","StyledNonLink","arrow","StyledIconArrow","size","StyledLink","to","e","preventDefault","browserHistory","props","forwardProps","omit","p","IconArrow","Actions","updateQuery","results","action","column","value","key","name","type","getDuration","Array","isArray","Set","length","ADD","removeFilterValue","addFilterValues","removeFilter","currentFilters","getFilterValues","String","setFilterValues","EXCLUDE","negation","currentNegations","filter","filterValue","includes","SHOW_GREATER_THAN","SHOW_LESS_THAN","TRANSACTION","RELEASE","DRILLDOWN","Error","CellAction","Component","constructor","super","isHovering","isOpen","event","this","menuEl","Element","contains","setState","state","portal","document","getElementById","createElement","setAttribute","body","appendChild","portalEl","componentDidUpdate","_props","prevState","addEventListener","handleClickOutside","removeEventListener","componentWillUnmount","renderMenu","actions","dataRow","handleCellAction","allowActions","isRelativeSpanOperationBreakdownField","isEquationAlias","kind","field","addMenuItem","menuItem","push","ActionItem","t","function","defined","project_threshold_config","EDIT_THRESHOLD","tct","threshold","makeCellActions","modifiers","enabled","options","padding","altAxis","offset","ARROW_SIZE","gpuAcceleration","menu","createPortal","placement","ref","popperRef","style","arrowProps","Menu","MenuArrow","MenuButtons","stopPropagation","MenuRoot","MenuButton","handleMenuToggle","color","render","children","Container","onMouseEnter","handleMouseEnter","onMouseLeave","handleMouseLeave","theme","zIndex","tooltip","background","border","borderRadius","dropShadowHeavy","translucentBorder","backgroundElevated","space","innerBorder","fontSizeMedium","backgroundSecondary","alpha","string"],"sourceRoot":""}