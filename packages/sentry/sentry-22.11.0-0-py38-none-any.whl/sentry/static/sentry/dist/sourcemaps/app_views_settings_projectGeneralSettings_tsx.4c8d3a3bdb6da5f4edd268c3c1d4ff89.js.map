{"version":3,"file":"chunks/app_views_settings_projectGeneralSettings_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"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","sources":["webpack:///./app/data/forms/projectGeneralSettings.tsx","webpack:///./app/utils/routeTitle.tsx","webpack:///./app/utils/slugify.tsx","webpack:///./app/views/asyncView.tsx","webpack:///./app/views/settings/project/permissionAlert.tsx","webpack:///./app/views/settings/projectGeneralSettings.tsx"],"sourcesContent":["import {createFilter} from 'react-select';\nimport styled from '@emotion/styled';\nimport {PlatformIcon} from 'platformicons';\n\nimport {Field} from 'sentry/components/forms/types';\nimport platforms from 'sentry/data/platforms';\nimport {t, tct, tn} from 'sentry/locale';\nimport space from 'sentry/styles/space';\nimport {convertMultilineFieldValue, extractMultilineFields} from 'sentry/utils';\nimport getDynamicText from 'sentry/utils/getDynamicText';\nimport slugify from 'sentry/utils/slugify';\n\n// Export route to make these forms searchable by label/help\nexport const route = '/settings/:orgId/projects/:projectId/';\n\nconst getResolveAgeAllowedValues = () => {\n  let i = 0;\n  const values: number[] = [];\n  while (i <= 720) {\n    values.push(i);\n    if (i < 12) {\n      i += 1;\n    } else if (i < 24) {\n      i += 3;\n    } else if (i < 36) {\n      i += 6;\n    } else if (i < 48) {\n      i += 12;\n    } else {\n      i += 24;\n    }\n  }\n  return values;\n};\n\nconst RESOLVE_AGE_ALLOWED_VALUES = getResolveAgeAllowedValues();\n\nconst ORG_DISABLED_REASON = t(\n  \"This option is enforced by your organization's settings and cannot be customized per-project.\"\n);\n\nconst PlatformWrapper = styled('div')`\n  display: flex;\n  align-items: center;\n`;\nconst StyledPlatformIcon = styled(PlatformIcon)`\n  margin-right: ${space(1)};\n`;\n\nexport const fields: Record<string, Field> = {\n  name: {\n    name: 'name',\n    type: 'string',\n    required: true,\n    label: t('Name'),\n    placeholder: t('my-awesome-project'),\n    help: t('A name for this project'),\n    transformInput: slugify,\n    getData: (data: {name?: string}) => {\n      return {\n        name: data.name,\n        slug: data.name,\n      };\n    },\n\n    saveOnBlur: false,\n    saveMessageAlertType: 'info',\n    saveMessage: t('You will be redirected to the new project slug after saving'),\n  },\n\n  platform: {\n    name: 'platform',\n    type: 'select',\n    label: t('Platform'),\n    options: platforms.map(({id, name}) => ({\n      value: id,\n      label: (\n        <PlatformWrapper key={id}>\n          <StyledPlatformIcon platform={id} />\n          {name}\n        </PlatformWrapper>\n      ),\n    })),\n    help: t('The primary platform for this project'),\n    filterOption: createFilter({\n      stringify: option => {\n        const matchedPlatform = platforms.find(({id}) => id === option.value);\n        return `${matchedPlatform?.name} ${option.value}`;\n      },\n    }),\n  },\n\n  subjectPrefix: {\n    name: 'subjectPrefix',\n    type: 'string',\n    label: t('Subject Prefix'),\n    placeholder: t('e.g. [my-org]'),\n    help: t('Choose a custom prefix for emails from this project'),\n  },\n\n  resolveAge: {\n    name: 'resolveAge',\n    type: 'range',\n    allowedValues: RESOLVE_AGE_ALLOWED_VALUES,\n    label: t('Auto Resolve'),\n    help: t(\n      \"Automatically resolve an issue if it hasn't been seen for this amount of time\"\n    ),\n    formatLabel: val => {\n      val = Number(val);\n      if (val === 0) {\n        return t('Disabled');\n      }\n\n      if (val > 23 && val % 24 === 0) {\n        // Based on allowed values, val % 24 should always be true\n        val = val / 24;\n        return tn('%s day', '%s days', val);\n      }\n\n      return tn('%s hour', '%s hours', val);\n    },\n    saveOnBlur: false,\n    saveMessage: tct(\n      '[strong:Caution]: Enabling auto resolve will immediately resolve anything that has not been seen within this period of time. There is no undo!',\n      {\n        strong: <strong />,\n      }\n    ),\n    saveMessageAlertType: 'warning',\n  },\n  allowedDomains: {\n    name: 'allowedDomains',\n    type: 'string',\n    multiline: true,\n    autosize: true,\n    maxRows: 10,\n    rows: 1,\n    placeholder: t('https://example.com or example.com'),\n    label: t('Allowed Domains'),\n    help: t(\n      'Examples: https://example.com, *, *.example.com, *:80. Separate multiple entries with a newline'\n    ),\n    getValue: val => extractMultilineFields(val),\n    setValue: val => convertMultilineFieldValue(val),\n  },\n  scrapeJavaScript: {\n    name: 'scrapeJavaScript',\n    type: 'boolean',\n    // if this is off for the organization, it cannot be enabled for the project\n    disabled: ({organization, name}) => !organization[name],\n    disabledReason: ORG_DISABLED_REASON,\n    // `props` are the props given to FormField\n    setValue: (val, props) => props.organization && props.organization[props.name] && val,\n    label: t('Enable JavaScript source fetching'),\n    help: t('Allow Sentry to scrape missing JavaScript source context when possible'),\n  },\n  securityToken: {\n    name: 'securityToken',\n    type: 'string',\n    label: t('Security Token'),\n    help: t(\n      'Outbound requests matching Allowed Domains will have the header \"{token_header}: {token}\" appended'\n    ),\n    setValue: value => getDynamicText({value, fixed: '__SECURITY_TOKEN__'}),\n  },\n  securityTokenHeader: {\n    name: 'securityTokenHeader',\n    type: 'string',\n    placeholder: t('X-Sentry-Token'),\n    label: t('Security Token Header'),\n    help: t(\n      'Outbound requests matching Allowed Domains will have the header \"{token_header}: {token}\" appended'\n    ),\n  },\n  verifySSL: {\n    name: 'verifySSL',\n    type: 'boolean',\n    label: t('Verify TLS/SSL'),\n    help: t('Outbound requests will verify TLS (sometimes known as SSL) connections'),\n  },\n};\n","function routeTitleGen(\n  routeName: string,\n  orgSlug: string,\n  withSentry: boolean = true,\n  projectSlug?: string\n): string {\n  const tmplBase = `${routeName} - ${orgSlug}`;\n  const tmpl = projectSlug ? `${tmplBase} - ${projectSlug}` : tmplBase;\n\n  return withSentry ? `${tmpl} - Sentry` : tmpl;\n}\n\nexport default routeTitleGen;\n","/**\n * Transforms the given string to a slugified version. (e.g. \"My Project\" => \"my-project\")\n *\n * Allows only lowercase alphanumeric values, hyphens, and underscores (should match backend validation rules).\n * Normalizes special characters to a-z where applicable (accents, ligatures, etc).\n * Converts spaces to hyphens.\n */\nexport default function slugify(str: string): string {\n  return str\n    .normalize('NFKD') // Converts accents/ligatures/etc to latin alphabet\n    .toLowerCase()\n    .replace(' ', '-')\n    .replace(/[^a-z0-9-_]/g, ''); // Remove all invalid characters\n}\n","import AsyncComponent from 'sentry/components/asyncComponent';\nimport SentryDocumentTitle from 'sentry/components/sentryDocumentTitle';\n\ntype AsyncViewState = AsyncComponent['state'];\ntype AsyncViewProps = AsyncComponent['props'];\n\nexport default class AsyncView<\n  P extends AsyncViewProps = AsyncViewProps,\n  S extends AsyncViewState = AsyncViewState\n> extends AsyncComponent<P, S> {\n  getTitle() {\n    return '';\n  }\n\n  render() {\n    return (\n      <SentryDocumentTitle title={this.getTitle()}>\n        {this.renderComponent() as React.ReactChild}\n      </SentryDocumentTitle>\n    );\n  }\n}\n","import Access from 'sentry/components/acl/access';\nimport Alert from 'sentry/components/alert';\nimport {t} from 'sentry/locale';\n\ntype Props = React.ComponentPropsWithoutRef<typeof Alert> &\n  Pick<React.ComponentProps<typeof Access>, 'access'>;\n\nconst PermissionAlert = ({access = ['project:write'], ...props}: Props) => (\n  <Access access={access}>\n    {({hasAccess}) =>\n      !hasAccess && (\n        <Alert data-test-id=\"project-permission-alert\" type=\"warning\" {...props}>\n          {t(\n            'These settings can only be edited by users with the organization owner, manager, or admin role.'\n          )}\n        </Alert>\n      )\n    }\n  </Access>\n);\n\nexport default PermissionAlert;\n","import {Component} from 'react';\nimport {browserHistory, RouteComponentProps} from 'react-router';\n\nimport {\n  changeProjectSlug,\n  removeProject,\n  transferProject,\n} from 'sentry/actionCreators/projects';\nimport Button from 'sentry/components/button';\nimport Confirm from 'sentry/components/confirm';\nimport Field from 'sentry/components/forms/field';\nimport TextField from 'sentry/components/forms/fields/textField';\nimport Form, {FormProps} from 'sentry/components/forms/form';\nimport JsonForm from 'sentry/components/forms/jsonForm';\nimport {FieldValue} from 'sentry/components/forms/model';\nimport Hook from 'sentry/components/hook';\nimport {removePageFiltersStorage} from 'sentry/components/organizations/pageFilters/persistence';\nimport {Panel, PanelAlert, PanelHeader} from 'sentry/components/panels';\nimport {fields} from 'sentry/data/forms/projectGeneralSettings';\nimport {t, tct} from 'sentry/locale';\nimport ProjectsStore from 'sentry/stores/projectsStore';\nimport {Organization, Project} from 'sentry/types';\nimport handleXhrErrorResponse from 'sentry/utils/handleXhrErrorResponse';\nimport recreateRoute from 'sentry/utils/recreateRoute';\nimport routeTitleGen from 'sentry/utils/routeTitle';\nimport withOrganization from 'sentry/utils/withOrganization';\nimport AsyncView from 'sentry/views/asyncView';\nimport SettingsPageHeader from 'sentry/views/settings/components/settingsPageHeader';\nimport TextBlock from 'sentry/views/settings/components/text/textBlock';\nimport PermissionAlert from 'sentry/views/settings/project/permissionAlert';\n\ntype Props = AsyncView['props'] &\n  RouteComponentProps<{orgId: string; projectId: string}, {}> & {\n    onChangeSlug: (slug: string) => void;\n    organization: Organization;\n  };\n\ntype State = AsyncView['state'] & {\n  data: Project;\n};\n\nclass ProjectGeneralSettings extends AsyncView<Props, State> {\n  private _form: Record<string, FieldValue> = {};\n\n  getTitle() {\n    const {projectId} = this.props.params;\n    return routeTitleGen(t('Project Settings'), projectId, false);\n  }\n\n  getEndpoints(): ReturnType<AsyncView['getEndpoints']> {\n    const {orgId, projectId} = this.props.params;\n\n    return [['data', `/projects/${orgId}/${projectId}/`]];\n  }\n\n  handleTransferFieldChange = (id: string, value: FieldValue) => {\n    this._form[id] = value;\n  };\n\n  handleRemoveProject = () => {\n    const {orgId} = this.props.params;\n    const project = this.state.data;\n\n    removePageFiltersStorage(orgId);\n\n    if (!project) {\n      return;\n    }\n\n    removeProject(this.api, orgId, project).then(() => {\n      // Need to hard reload because lots of components do not listen to Projects Store\n      window.location.assign('/');\n    }, handleXhrErrorResponse('Unable to remove project'));\n  };\n\n  handleTransferProject = async () => {\n    const {orgId} = this.props.params;\n    const project = this.state.data;\n    if (!project) {\n      return;\n    }\n    if (typeof this._form.email !== 'string' || this._form.email.length < 1) {\n      return;\n    }\n\n    try {\n      await transferProject(this.api, orgId, project, this._form.email);\n      // Need to hard reload because lots of components do not listen to Projects Store\n      window.location.assign('/');\n    } catch (err) {\n      if (err.status >= 500) {\n        handleXhrErrorResponse('Unable to transfer project')(err);\n      }\n    }\n  };\n\n  isProjectAdmin = () => new Set(this.props.organization.access).has('project:admin');\n\n  renderRemoveProject() {\n    const project = this.state.data;\n    const isProjectAdmin = this.isProjectAdmin();\n    const {isInternal} = project;\n\n    return (\n      <Field\n        label={t('Remove Project')}\n        help={tct(\n          'Remove the [project] project and all related data. [linebreak] Careful, this action cannot be undone.',\n          {\n            project: <strong>{project.slug}</strong>,\n            linebreak: <br />,\n          }\n        )}\n      >\n        {!isProjectAdmin &&\n          t('You do not have the required permission to remove this project.')}\n\n        {isInternal &&\n          t(\n            'This project cannot be removed. It is used internally by the Sentry server.'\n          )}\n\n        {isProjectAdmin && !isInternal && (\n          <Confirm\n            onConfirm={this.handleRemoveProject}\n            priority=\"danger\"\n            confirmText={t('Remove Project')}\n            message={\n              <div>\n                <TextBlock>\n                  <strong>\n                    {t('Removing this project is permanent and cannot be undone!')}\n                  </strong>\n                </TextBlock>\n                <TextBlock>\n                  {t('This will also remove all associated event data.')}\n                </TextBlock>\n              </div>\n            }\n          >\n            <div>\n              <Button type=\"button\" priority=\"danger\">\n                {t('Remove Project')}\n              </Button>\n            </div>\n          </Confirm>\n        )}\n      </Field>\n    );\n  }\n\n  renderTransferProject() {\n    const project = this.state.data;\n    const isProjectAdmin = this.isProjectAdmin();\n    const {isInternal} = project;\n\n    return (\n      <Field\n        label={t('Transfer Project')}\n        help={tct(\n          'Transfer the [project] project and all related data. [linebreak] Careful, this action cannot be undone.',\n          {\n            project: <strong>{project.slug}</strong>,\n            linebreak: <br />,\n          }\n        )}\n      >\n        {!isProjectAdmin &&\n          t('You do not have the required permission to transfer this project.')}\n\n        {isInternal &&\n          t(\n            'This project cannot be transferred. It is used internally by the Sentry server.'\n          )}\n\n        {isProjectAdmin && !isInternal && (\n          <Confirm\n            onConfirm={this.handleTransferProject}\n            priority=\"danger\"\n            confirmText={t('Transfer project')}\n            renderMessage={({confirm}) => (\n              <div>\n                <TextBlock>\n                  <strong>\n                    {t('Transferring this project is permanent and cannot be undone!')}\n                  </strong>\n                </TextBlock>\n                <TextBlock>\n                  {t(\n                    'Please enter the email of an organization owner to whom you would like to transfer this project.'\n                  )}\n                </TextBlock>\n                <Panel>\n                  <Form\n                    hideFooter\n                    onFieldChange={this.handleTransferFieldChange}\n                    onSubmit={(_data, _onSuccess, _onError, e) => {\n                      e.stopPropagation();\n                      confirm();\n                    }}\n                  >\n                    <TextField\n                      name=\"email\"\n                      label={t('Organization Owner')}\n                      placeholder=\"admin@example.com\"\n                      required\n                      help={t(\n                        'A request will be emailed to this address, asking the organization owner to accept the project transfer.'\n                      )}\n                    />\n                  </Form>\n                </Panel>\n              </div>\n            )}\n          >\n            <div>\n              <Button type=\"button\" priority=\"danger\">\n                {t('Transfer Project')}\n              </Button>\n            </div>\n          </Confirm>\n        )}\n      </Field>\n    );\n  }\n\n  renderBody() {\n    const {organization} = this.props;\n    const project = this.state.data;\n    const {orgId, projectId} = this.props.params;\n    const endpoint = `/projects/${orgId}/${projectId}/`;\n    const access = new Set(organization.access);\n    const jsonFormProps = {\n      additionalFieldProps: {\n        organization,\n      },\n      features: new Set(organization.features),\n      access,\n      disabled: !access.has('project:write'),\n    };\n    const team = project.teams.length ? project.teams?.[0] : undefined;\n\n    /*\n    HACK: The <Form /> component applies its props to its children meaning the hooked component\n          would need to conform to the form settings applied in a separate repository. This is\n          not feasible to maintain and may introduce compatability errors if something changes\n          in either repository. For that reason, the Form component is split in two, since the\n          fields do not depend on one another, allowing for the Hook to manage it's own state.\n    */\n    const formProps: FormProps = {\n      saveOnBlur: true,\n      allowUndo: true,\n      initialData: {\n        ...project,\n        team,\n      },\n      apiMethod: 'PUT' as const,\n      apiEndpoint: endpoint,\n      onSubmitSuccess: resp => {\n        this.setState({data: resp});\n        if (projectId !== resp.slug) {\n          changeProjectSlug(projectId, resp.slug);\n          // Container will redirect after stores get updated with new slug\n          this.props.onChangeSlug(resp.slug);\n        }\n        // This will update our project context\n        ProjectsStore.onUpdateSuccess(resp);\n      },\n    };\n\n    return (\n      <div>\n        <SettingsPageHeader title={t('Project Settings')} />\n        <PermissionAlert />\n\n        <Form {...formProps}>\n          <JsonForm\n            {...jsonFormProps}\n            title={t('Project Details')}\n            fields={[fields.name, fields.platform]}\n          />\n\n          <JsonForm\n            {...jsonFormProps}\n            title={t('Email')}\n            fields={[fields.subjectPrefix]}\n          />\n        </Form>\n        <Hook\n          name=\"spend-visibility:spike-protection-project-settings\"\n          project={project}\n        />\n        <Form {...formProps}>\n          <JsonForm\n            {...jsonFormProps}\n            title={t('Event Settings')}\n            fields={[fields.resolveAge]}\n          />\n\n          <JsonForm\n            {...jsonFormProps}\n            title={t('Client Security')}\n            fields={[\n              fields.allowedDomains,\n              fields.scrapeJavaScript,\n              fields.securityToken,\n              fields.securityTokenHeader,\n              fields.verifySSL,\n            ]}\n            renderHeader={() => (\n              <PanelAlert type=\"info\">\n                <TextBlock noMargin>\n                  {tct(\n                    'Configure origin URLs which Sentry should accept events from. This is used for communication with clients like [link].',\n                    {\n                      link: (\n                        <a href=\"https://github.com/getsentry/sentry-javascript\">\n                          sentry-javascript\n                        </a>\n                      ),\n                    }\n                  )}{' '}\n                  {tct(\n                    'This will restrict requests based on the [Origin] and [Referer] headers.',\n                    {\n                      Origin: <code>Origin</code>,\n                      Referer: <code>Referer</code>,\n                    }\n                  )}\n                </TextBlock>\n              </PanelAlert>\n            )}\n          />\n        </Form>\n\n        <Panel>\n          <PanelHeader>{t('Project Administration')}</PanelHeader>\n          {this.renderRemoveProject()}\n          {this.renderTransferProject()}\n        </Panel>\n      </div>\n    );\n  }\n}\n\ntype ContainerProps = {\n  organization: Organization;\n} & RouteComponentProps<{orgId: string; projectId: string}, {}>;\n\nclass ProjectGeneralSettingsContainer extends Component<ContainerProps> {\n  componentWillUnmount() {\n    this.unsubscribe();\n  }\n\n  changedSlug: string | undefined = undefined;\n  unsubscribe = ProjectsStore.listen(() => this.onProjectsUpdate(), undefined);\n\n  onProjectsUpdate() {\n    if (!this.changedSlug) {\n      return;\n    }\n    const project = ProjectsStore.getBySlug(this.changedSlug);\n\n    if (!project) {\n      return;\n    }\n\n    browserHistory.replace(\n      recreateRoute('', {\n        ...this.props,\n        params: {\n          ...this.props.params,\n          projectId: this.changedSlug,\n        },\n      })\n    );\n  }\n\n  render() {\n    return (\n      <ProjectGeneralSettings\n        onChangeSlug={(newSlug: string) => (this.changedSlug = newSlug)}\n        {...this.props}\n      />\n    );\n  }\n}\n\nexport default withOrganization(ProjectGeneralSettingsContainer);\n"],"names":["route","RESOLVE_AGE_ALLOWED_VALUES","i","values","push","getResolveAgeAllowedValues","ORG_DISABLED_REASON","t","PlatformWrapper","StyledPlatformIcon","PlatformIcon","space","fields","name","type","required","label","placeholder","help","transformInput","slugify","getData","data","slug","saveOnBlur","saveMessageAlertType","saveMessage","platform","options","platforms","id","value","filterOption","createFilter","stringify","option","subjectPrefix","resolveAge","allowedValues","formatLabel","val","Number","tn","tct","strong","allowedDomains","multiline","autosize","maxRows","rows","getValue","extractMultilineFields","setValue","convertMultilineFieldValue","scrapeJavaScript","disabled","organization","disabledReason","props","securityToken","getDynamicText","fixed","securityTokenHeader","verifySSL","routeName","orgSlug","withSentry","projectSlug","tmplBase","tmpl","str","normalize","toLowerCase","replace","AsyncView","AsyncComponent","getTitle","render","title","this","renderComponent","PermissionAlert","access","hasAccess","ProjectGeneralSettings","_form","orgId","params","project","state","removePageFiltersStorage","removeProject","api","then","window","location","assign","handleXhrErrorResponse","async","email","length","transferProject","err","status","Set","has","projectId","routeTitleGen","getEndpoints","renderRemoveProject","isProjectAdmin","isInternal","linebreak","onConfirm","handleRemoveProject","priority","confirmText","message","renderTransferProject","handleTransferProject","renderMessage","confirm","hideFooter","onFieldChange","handleTransferFieldChange","onSubmit","_data","_onSuccess","_onError","e","stopPropagation","renderBody","endpoint","jsonFormProps","additionalFieldProps","features","team","teams","undefined","formProps","allowUndo","initialData","apiMethod","apiEndpoint","onSubmitSuccess","resp","setState","changeProjectSlug","onChangeSlug","ProjectsStore","renderHeader","noMargin","link","href","Origin","Referer","ProjectGeneralSettingsContainer","Component","onProjectsUpdate","componentWillUnmount","unsubscribe","changedSlug","browserHistory","recreateRoute","newSlug","withOrganization"],"sourceRoot":""}