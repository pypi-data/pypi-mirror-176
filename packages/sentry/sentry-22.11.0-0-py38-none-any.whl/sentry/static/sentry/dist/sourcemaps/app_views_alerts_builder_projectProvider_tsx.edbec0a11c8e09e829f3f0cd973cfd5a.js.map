{"version":3,"file":"chunks/app_views_alerts_builder_projectProvider_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"sqBAwBA,SAASA,EAA4BC,GACnC,MAAMC,GAAMC,EAAAA,EAAAA,KACNC,GAAeC,EAAAA,EAAAA,MACdC,EAASC,IAAcC,EAAAA,EAAAA,eAA+BC,IAC7DC,EAAAA,EAAAA,GAAe,CAACC,SAAUV,EAAMU,WAEhC,MAAM,SAACC,EAAQ,OAAEC,EAAM,aAAEC,KAAiBC,GAASd,EAC7Ce,EAAYH,EAAOG,WAAaf,EAAMU,SAASM,MAAMC,QACrDC,OAAgCV,IAAdO,GAGlB,SAACI,EAAQ,gBAAEC,EAAe,SAAEC,EAAQ,WAAEC,IAAcC,EAAAA,EAAAA,GACxDL,OACIV,EACA,CACEgB,MAAO,CAACT,KAGVE,EAAUC,EACZC,EAASM,MAAKC,GAAKA,EAAEC,aAAcR,EAASS,QAAUT,EAAS,IAC/DA,EAASM,MAAK,QAAC,KAACI,GAAK,SAAKA,IAASd,CAAS,IAehD,OAbAe,EAAAA,EAAAA,YAAU,KACHb,IAKLc,EAAAA,EAAAA,IAAgB9B,EAAKY,EAAagB,KAAM,CAACZ,EAAQe,KAAKC,MAAKC,IACrD/B,EAAagC,SACf7B,EAAW4B,EACb,GACA,GACD,CAACjC,EAAKY,EAAcV,EAAcc,KAEhCG,GAAmBC,GACf,QAAC,IAAgB,KAIrBJ,GAAYK,IACfc,EAAAA,EAAAA,GACG,kBAAiBvB,EAAagB,gCAAgC7B,EAAMU,SAASM,MAAMqB,8BACpFrC,EAAMsC,SAKLrB,GAAWK,GAEZ,QAAC,IAAK,CAACiB,KAAK,UAAS,UAAEC,EAAAA,EAAAA,GAAE,sDAK3B,QAAC,EAAAC,SAAQ,UACN9B,IAAY+B,EAAAA,EAAAA,gBAAe/B,IACxBgC,EAAAA,EAAAA,cAAahC,EAAU,IAClBG,KACAH,EAASX,MACZiB,UACAF,UAAWG,EAAkBD,EAAQY,KAAOd,EAC5CF,eACAR,YAEFM,IAGV,CApESZ,EAA2B,0CAsEpC,S","sources":["webpack:///./app/views/alerts/builder/projectProvider.tsx"],"sourcesContent":["import {cloneElement, Fragment, isValidElement, useEffect, useState} from 'react';\nimport {RouteComponentProps} from 'react-router';\n\nimport {fetchOrgMembers} from 'sentry/actionCreators/members';\nimport {navigateTo} from 'sentry/actionCreators/navigation';\nimport Alert from 'sentry/components/alert';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport {t} from 'sentry/locale';\nimport {Member, Organization} from 'sentry/types';\nimport useApi from 'sentry/utils/useApi';\nimport {useIsMountedRef} from 'sentry/utils/useIsMountedRef';\nimport useProjects from 'sentry/utils/useProjects';\nimport useScrollToTop from 'sentry/utils/useScrollToTop';\n\ntype Props = RouteComponentProps<RouteParams, {}> & {\n  hasMetricAlerts: boolean;\n  organization: Organization;\n  children?: React.ReactNode;\n};\n\ntype RouteParams = {\n  projectId?: string;\n};\n\nfunction AlertBuilderProjectProvider(props: Props) {\n  const api = useApi();\n  const isMountedRef = useIsMountedRef();\n  const [members, setMembers] = useState<Member[] | undefined>(undefined);\n  useScrollToTop({location: props.location});\n\n  const {children, params, organization, ...other} = props;\n  const projectId = params.projectId || props.location.query.project;\n  const useFirstProject = projectId === undefined;\n\n  // calling useProjects() without args fetches all projects\n  const {projects, initiallyLoaded, fetching, fetchError} = useProjects(\n    useFirstProject\n      ? undefined\n      : {\n          slugs: [projectId],\n        }\n  );\n  const project = useFirstProject\n    ? projects.find(p => p.isMember) ?? (projects.length && projects[0])\n    : projects.find(({slug}) => slug === projectId);\n\n  useEffect(() => {\n    if (!project) {\n      return;\n    }\n\n    // fetch members list for mail action fields\n    fetchOrgMembers(api, organization.slug, [project.id]).then(mem => {\n      if (isMountedRef.current) {\n        setMembers(mem);\n      }\n    });\n  }, [api, organization, isMountedRef, project]);\n\n  if (!initiallyLoaded || fetching) {\n    return <LoadingIndicator />;\n  }\n\n  // If there's no project show the project selector modal\n  if (!project && !fetchError) {\n    navigateTo(\n      `/organizations/${organization.slug}/alerts/wizard/?referrer=${props.location.query.referrer}&project=:projectId`,\n      props.router\n    );\n  }\n\n  // if loaded, but project fetching states incomplete or project can't be found, project doesn't exist\n  if (!project || fetchError) {\n    return (\n      <Alert type=\"warning\">{t('The project you were looking for was not found.')}</Alert>\n    );\n  }\n\n  return (\n    <Fragment>\n      {children && isValidElement(children)\n        ? cloneElement(children, {\n            ...other,\n            ...children.props,\n            project,\n            projectId: useFirstProject ? project.slug : projectId,\n            organization,\n            members,\n          })\n        : children}\n    </Fragment>\n  );\n}\n\nexport default AlertBuilderProjectProvider;\n"],"names":["AlertBuilderProjectProvider","props","api","useApi","isMountedRef","useIsMountedRef","members","setMembers","useState","undefined","useScrollToTop","location","children","params","organization","other","projectId","query","project","useFirstProject","projects","initiallyLoaded","fetching","fetchError","useProjects","slugs","find","p","isMember","length","slug","useEffect","fetchOrgMembers","id","then","mem","current","navigateTo","referrer","router","type","t","Fragment","isValidElement","cloneElement"],"sourceRoot":""}